<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TD2-5 – Emmanuel Pilliat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b4406b7675125bc2ba204020e191172.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-338eaa8bf8d7f1eb506da55f2b711d05.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Emmanuel Pilliat</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/epilliat"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fr.linkedin.com/in/emmanuel-pilliat-18ab2b180"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="incremental">
  <li><a href="#exercise-1.-r-lab-on-eucalyptus-data" id="toc-exercise-1.-r-lab-on-eucalyptus-data" class="nav-link active" data-scroll-target="#exercise-1.-r-lab-on-eucalyptus-data">Exercise 1. R Lab on Eucalyptus Data</a></li>
  <li><a href="#exercise-2.-the-fisher-test-and-r2" id="toc-exercise-2.-the-fisher-test-and-r2" class="nav-link" data-scroll-target="#exercise-2.-the-fisher-test-and-r2">Exercise 2. The Fisher Test and <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#exercise-3.-r-lab-on-ice-cream-consumption" id="toc-exercise-3.-r-lab-on-ice-cream-consumption" class="nav-link" data-scroll-target="#exercise-3.-r-lab-on-ice-cream-consumption">Exercise 3. R Lab on Ice Cream Consumption</a></li>
  <li><a href="#exercise-4.-the-multiple-correlation-coefficient-with-or-without-constant" id="toc-exercise-4.-the-multiple-correlation-coefficient-with-or-without-constant" class="nav-link" data-scroll-target="#exercise-4.-the-multiple-correlation-coefficient-with-or-without-constant">Exercise 4. The Multiple Correlation Coefficient with or without Constant</a></li>
  <li><a href="#exercise-5.-the-interpretation-of-r2-as-multiple-correlation-coefficient" id="toc-exercise-5.-the-interpretation-of-r2-as-multiple-correlation-coefficient" class="nav-link" data-scroll-target="#exercise-5.-the-interpretation-of-r2-as-multiple-correlation-coefficient">Exercise 5. The Interpretation of <span class="math inline">\(R^2\)</span> as Multiple Correlation Coefficient</a></li>
  <li><a href="#exercise-6.-effect-of-multicollinearity" id="toc-exercise-6.-effect-of-multicollinearity" class="nav-link" data-scroll-target="#exercise-6.-effect-of-multicollinearity">Exercise 6. Effect of Multicollinearity</a></li>
  <li><a href="#exercise-7.-modeling-the-daily-maximum-ozone-concentration" id="toc-exercise-7.-modeling-the-daily-maximum-ozone-concentration" class="nav-link" data-scroll-target="#exercise-7.-modeling-the-daily-maximum-ozone-concentration">Exercise 7. Modeling the Daily Maximum Ozone Concentration</a></li>
  <li><a href="#exercise-8.-comparison-of-model-selection-criteria" id="toc-exercise-8.-comparison-of-model-selection-criteria" class="nav-link" data-scroll-target="#exercise-8.-comparison-of-model-selection-criteria">Exercise 8. Comparison of Model Selection Criteria</a></li>
  <li><a href="#exercise-9.-over-fitting-probability-of-selection-criteria" id="toc-exercise-9.-over-fitting-probability-of-selection-criteria" class="nav-link" data-scroll-target="#exercise-9.-over-fitting-probability-of-selection-criteria">Exercise 9. Over-fitting Probability of Selection Criteria</a></li>
  <li><a href="#exercise-10.-ancova-return-to-ozone-modeling" id="toc-exercise-10.-ancova-return-to-ozone-modeling" class="nav-link" data-scroll-target="#exercise-10.-ancova-return-to-ozone-modeling">Exercise 10. ANCOVA: Return to Ozone Modeling</a></li>
  <li><a href="#exercise-11.-generalized-least-squares" id="toc-exercise-11.-generalized-least-squares" class="nav-link" data-scroll-target="#exercise-11.-generalized-least-squares">Exercise 11. Generalized Least Squares</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TD2-5</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="exercise-1.-r-lab-on-eucalyptus-data" class="level1">
<h1>Exercise 1. R Lab on Eucalyptus Data</h1>
<p>We want to explain the height of eucalyptus trees based on their circumference using simple linear regression. We have measurements of heights (ht) and circumferences (circ) of 1429 eucalyptus trees, which are found in the file “eucalyptus.txt”.</p>
<ol class="incremental" type="1">
<li><p>Extract and plot the data in a scatter plot.</p></li>
<li><p>Perform the regression <span class="math inline">\(y = \beta_1 + \beta_2 x + \varepsilon\)</span> where <span class="math inline">\(y\)</span> represents the height and <span class="math inline">\(x\)</span> the circumference. Comment on the results.</p></li>
<li><p>What is the theoretical formula for <span class="math inline">\(\hat{\beta}_1\)</span> and <span class="math inline">\(\hat{\beta}_2\)</span>? Retrieve the estimates provided by R using it.</p></li>
<li><p>Calculate a 95% confidence interval for <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>, assuming the normality of the data.</p></li>
<li><p>If the noise <span class="math inline">\(\varepsilon\)</span> does not follow a normal distribution, do the previous confidence intervals remain valid?</p></li>
<li><p>Plot the estimator of the regression line and a 95% confidence interval for it. What do you conclude about the quality of the estimation?</p></li>
<li><p>We now want to predict the height of a new series of eucalyptus trees with circumferences 50, 100, 150, and 200. Give the estimators of the height of each of them and the associated 95% prediction intervals, assuming the normality of the data.</p></li>
<li><p>Add to the graphical representation from question 6 the prediction intervals (associated with the same circumference values).</p></li>
<li><p>If the noise <span class="math inline">\(\varepsilon\)</span> does not follow a normal distribution, do the previous prediction intervals remain valid?</p></li>
</ol>
</section>
<section id="exercise-2.-the-fisher-test-and-r2" class="level1">
<h1>Exercise 2. The Fisher Test and <span class="math inline">\(R^2\)</span></h1>
<p>Consider a multiple linear regression model <span class="math inline">\(y = X\beta + \varepsilon\)</span> where <span class="math inline">\(\beta \in \mathbb{R}^p\)</span>, <span class="math inline">\(X\)</span> is a matrix of size <span class="math inline">\((n, p)\)</span> and <span class="math inline">\(\varepsilon\)</span> is a random vector of size <span class="math inline">\(n\)</span>, centered with covariance matrix <span class="math inline">\(\sigma^2 I_n\)</span> (<span class="math inline">\(I_n\)</span> is the identity matrix).</p>
<p>We want to test <span class="math inline">\(q\)</span> linear constraints on the parameter <span class="math inline">\(\beta\)</span>, that is to test <span class="math inline">\(H_0: R\beta = 0\)</span> against <span class="math inline">\(H_1: R\beta \neq 0\)</span>, where <span class="math inline">\(R\)</span> is a matrix of size <span class="math inline">\((q, p)\)</span>.</p>
<p>We denote SSR the sum of squared residuals of the initial model, and <span class="math inline">\(\text{SSR}_c\)</span> the sum of squared residuals of the constrained model (i.e., for which hypothesis <span class="math inline">\(H_0\)</span> is verified).</p>
<ol class="incremental" type="1">
<li><p>Recall the statistic used to perform this test. Denote it <span class="math inline">\(F\)</span> and give its expression as a function of SSR and <span class="math inline">\(\text{SSR}_c\)</span>.</p></li>
<li><p>What distribution does this statistic follow under <span class="math inline">\(H_0\)</span> when <span class="math inline">\(\varepsilon\)</span> follows a normal distribution? What can be said about its distribution if no normality assumption is made on <span class="math inline">\(\varepsilon\)</span>?</p></li>
<li><p>Show that if a constant is present in the constrained model, <span class="math display">\[F = \frac{R^2 - R^2_c}{1 - R^2} \cdot \frac{n - p}{q}\]</span> where <span class="math inline">\(R^2\)</span> (respectively <span class="math inline">\(R^2_c\)</span>) denotes the coefficient of determination of the initial model (respectively of the constrained model).</p></li>
</ol>
</section>
<section id="exercise-3.-r-lab-on-ice-cream-consumption" class="level1">
<h1>Exercise 3. R Lab on Ice Cream Consumption</h1>
<p>We study ice cream consumption in the United States over a period of 30 weeks from March 18, 1950 to July 11, 1953. The variables are the period (from week 1 to week 30), and on average for each period: ice cream consumption per person (“Consumption”, in 1/2 liter), price of ice cream (“Price”, in dollars), average weekly salary per household (“Income”, in dollars), and temperature (“Temp”, in degrees Fahrenheit). The data are available in the file “icecream-R.dat”.</p>
<ol class="incremental" type="1">
<li><p>Extract the data and plot consumption as a function of the different variables.</p></li>
<li><p>We propose to linearly regress consumption on the three variables “Price”, “Income” and “Temp”, also assuming that a constant is present in the model. Denote the constant <span class="math inline">\(\beta_1\)</span> and the three coefficients associated with the previous variables <span class="math inline">\(\beta_2\)</span>, <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> respectively. Perform the estimation phase of this regression and comment on the sign of the estimated coefficients.</p></li>
<li><p>Test the global significance of the proposed model, i.e.&nbsp;<span class="math inline">\(H_0: \beta_2 = \beta_3 = \beta_4 = 0\)</span>, using the global Fisher test.</p></li>
<li><p>Test the significance of the variable “Price” in this model at the 5% level. Similarly test the significance of “Income”, then of “Temp”.</p></li>
<li><p>Compare the previous complete model and the model without the “Price” variable using a Fisher test:</p>
<ol class="incremental" type="1">
<li>Basing the calculation on the sum of squared residuals of each model;</li>
<li>Basing the calculation on the coefficient of determination of each model;</li>
<li>Using the linearHypothesis function from the car library.</li>
<li>Using the anova function.</li>
</ol>
<p>What is the difference between this test and the Student’s t-test of significance of the “Price” variable?</p></li>
<li><p>Compare the complete model and the model without the “Price” variable and without the constant using a Fisher test. Proceed according to the 4 methods described above. Comment.</p></li>
<li><p>We now want to predict ice cream consumption for the following data: <span class="math inline">\(\text{Price} = 0.3\)</span>, <span class="math inline">\(\text{Income} = 85\)</span> and <span class="math inline">\(\text{Temp} = 65\)</span>. Propose the prediction that seems best to you given the models studied previously. Give a 95% prediction interval around this prediction.</p></li>
<li><p>Under what hypothesis is the previous prediction interval valid? Verify it by observing the QQ-plot of the regression residuals and by performing a statistical test.</p></li>
<li><p>Verify the other hypotheses by recalling the definition and calculating the VIF (Variance Inflation Factor) of each explanatory variable and by performing a graphical analysis of the residuals.</p></li>
<li><p>Observe the 3D scatter plot of the variables “Consumption”, “Income” and “Temp”, and the fit by the linear model, using scatter3d from the car library.</p></li>
</ol>
</section>
<section id="exercise-4.-the-multiple-correlation-coefficient-with-or-without-constant" class="level1">
<h1>Exercise 4. The Multiple Correlation Coefficient with or without Constant</h1>
<p>Consider the regression model <span class="math display">\[y_i = \beta_0 + \beta_1 x_i^{(1)} + \cdots + \beta_p x_i^{(p)} + \varepsilon_i, \quad i = 1, \ldots, n, \quad (*)\]</span></p>
<p>where the variables <span class="math inline">\(\varepsilon_i\)</span> are centered, with variance <span class="math inline">\(\sigma^2\)</span> and uncorrelated. Let <span class="math inline">\(Y = (y_1, \ldots, y_n)^T\)</span>, <span class="math inline">\(X^{(k)} = (x_1^{(k)}, \ldots, x_n^{(k)})^T\)</span> and <span class="math inline">\(\mathbf{1} = (1, \ldots, 1)^T\)</span>. We assume that the variables <span class="math inline">\(X^{(k)}\)</span> are not linearly related to <span class="math inline">\(\mathbf{1}\)</span>. We denote <span class="math inline">\(\bar{y}\)</span> the empirical mean of <span class="math inline">\(Y\)</span> and <span class="math inline">\(\hat{Y} = \hat{\beta}_0 \mathbf{1} + \hat{\beta}_1 X^{(1)} + \cdots + \hat{\beta}_p X^{(p)}\)</span> where the estimators are those obtained by ordinary least squares.</p>
<ol class="incremental" type="1">
<li><p>What does <span class="math inline">\(\hat{Y}\)</span> represent geometrically? Draw a diagram showing the vectors <span class="math inline">\(Y\)</span>, <span class="math inline">\(\hat{Y}\)</span>, <span class="math inline">\(\bar{y}\mathbf{1}\)</span>, <span class="math inline">\(Y - \bar{y}\mathbf{1}\)</span>, <span class="math inline">\(\hat{Y} - \bar{y}\mathbf{1}\)</span> and <span class="math inline">\(\hat{\varepsilon}\)</span>.</p></li>
<li><p>Deduce the following equalities:</p>
<ol class="incremental" type="a">
<li><span class="math inline">\(\sum_{i=1}^n y_i^2 = \sum_{i=1}^n \hat{\varepsilon}_i^2 + \sum_{i=1}^n \hat{y}_i^2\)</span></li>
<li><span class="math inline">\(\sum_{i=1}^n (y_i - \bar{y})^2 = \sum_{i=1}^n \hat{\varepsilon}_i^2 + \sum_{i=1}^n (\hat{y}_i - \bar{y})^2\)</span></li>
</ol></li>
<li><p>Consider the ratios: <span class="math display">\[R_1^2 = \frac{\sum_{i=1}^n \hat{y}_i^2}{\sum_{i=1}^n y_i^2} \quad \quad R_2^2 = \frac{\sum_{i=1}^n (\hat{y}_i - \bar{y})^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</span></p>
<p>Justify that <span class="math inline">\(R_1^2 \geq R_2^2\)</span>. In which case do we have equality?</p></li>
<li><p>What is the definition of the multiple correlation coefficient for model <span class="math inline">\((*)\)</span>?</p></li>
<li><p>We now consider a regression model without constant, i.e., we set <span class="math inline">\(\beta_0 = 0\)</span> in <span class="math inline">\((*)\)</span>. Do the equalities shown in 2) remain valid? What is in this case the definition of the multiple correlation coefficient?</p></li>
<li><p>After estimating model <span class="math inline">\((*)\)</span> with or without the constant, we obtain <span class="math inline">\(R^2 = 0.72\)</span> with the constant and <span class="math inline">\(R^2 = 0.96\)</span> without the constant. Is the introduction of the constant relevant?</p></li>
</ol>
</section>
<section id="exercise-5.-the-interpretation-of-r2-as-multiple-correlation-coefficient" class="level1">
<h1>Exercise 5. The Interpretation of <span class="math inline">\(R^2\)</span> as Multiple Correlation Coefficient</h1>
<p>We place ourselves in a regression model containing a constant. We define <span class="math display">\[\rho(Y, X) = \sup_{\beta} \text{cor}(Y, X\beta)\]</span> where cor denotes the empirical correlation. This quantity is therefore the maximum correlation that can be obtained between <span class="math inline">\(Y\)</span> and a linear combination of the explanatory variables.</p>
<ol class="incremental" type="1">
<li><p>Show that <span class="math display">\[\text{cor}(Y, X\beta) = \frac{(X\hat{\beta} - \bar{Y}\mathbf{1})^T(X\beta - \bar{X\beta}\mathbf{1})}{\|Y - \bar{Y}\mathbf{1}\| \|X\beta - \bar{X\beta}\mathbf{1}\|}\]</span> where <span class="math inline">\(\hat{\beta}\)</span> is the OLS estimator of the regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>, and <span class="math inline">\(\bar{X}\)</span> denotes the vector of the <span class="math inline">\(p\)</span> empirical means of each explanatory variable.</p></li>
<li><p>Deduce that for all <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\text{cor}(Y, X\beta)^2 \leq R^2\)</span>, where <span class="math inline">\(R^2\)</span> is the multiple correlation coefficient of the regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>.</p></li>
<li><p>Show that the previous bound is attained when <span class="math inline">\(\beta = \hat{\beta}\)</span>.</p></li>
<li><p>Conclude that <span class="math inline">\(\rho(Y, X)^2 = R^2\)</span> justifying the terminology “multiple correlation coefficient”.</p></li>
</ol>
</section>
<section id="exercise-6.-effect-of-multicollinearity" class="level1">
<h1>Exercise 6. Effect of Multicollinearity</h1>
<p>Consider a model with two explanatory variables, assumed to be centered. From the estimation on <span class="math inline">\(n\)</span> individuals, we obtained the following matrices <span class="math inline">\(X^T X\)</span> and <span class="math inline">\(X^T Y\)</span>: <span class="math display">\[X^T X = \begin{pmatrix} 200 &amp; 150 \\ 150 &amp; 113 \end{pmatrix} \quad X^T Y = \begin{pmatrix} 350 \\ 263 \end{pmatrix}\]</span></p>
<p>The removal of one observation has modified these matrices as follows: <span class="math display">\[X^T X = \begin{pmatrix} 199 &amp; 149 \\ 149 &amp; 112 \end{pmatrix} \quad X^T Y = \begin{pmatrix} 347.5 \\ 261.5 \end{pmatrix}\]</span></p>
<ol class="incremental" type="1">
<li>Calculate the estimated coefficients of the regression in both cases.</li>
<li>Calculate the linear correlation coefficient between the two explanatory variables.</li>
<li>Comment.</li>
</ol>
</section>
<section id="exercise-7.-modeling-the-daily-maximum-ozone-concentration" class="level1">
<h1>Exercise 7. Modeling the Daily Maximum Ozone Concentration</h1>
<p>The data set “ozone.txt” contains the maximum ozone concentration (maxO3) measured each day of summer 2001 in Rennes. It also contains temperatures, cloudiness and wind speed measured at 9am, 12pm and 3pm (respectively T9, T12, T15, Ne9, Ne12, Ne15 and Vx9, Vx12, Vx15), as well as the main wind direction and the presence or absence of rain. We want to best explain the ozone concentration using the variables available in the dataset.</p>
<ol class="incremental" type="1">
<li><p>Analyze the scatter plot and the linear correlation between maxO3 and each of the available quantitative variables (i.e., T9, T12, T15, Ne9, Ne12, Ne15, Vx9, Vx12 and Vx15). Is it reasonable to assume that there is a linear relationship between maxO3 and these variables?</p></li>
<li><p>Fit the linear regression model explaining maxO3 as a function of all the previous quantitative variables. Test the significance of each of the explanatory variables in this model. Is the result in agreement with the observations from the previous question? Also test the global significance of the model. Comment.</p></li>
<li><p>Calculate the VIF (Variance Inflation Factor) for each of the explanatory variables of the previous model. How do these values explain the results of the Student’s t-tests performed above?</p></li>
<li><p>We decide to remove variables from the previous model. Which variables does it seem natural to remove in view of the previous question? Fit the new proposed model and repeat the analyses performed in the two previous questions.</p></li>
<li><p>Implement an automatic selection of the best possible sub-model of the “large” model fitted in question 2, according to the BIC criterion. You can use the regsubsets function from the leaps library (then plot.regsubsets) or step. Compare the retained model with the model chosen in the previous question.</p></li>
<li><p>Apply the previous automatic selection based on criteria other than BIC. Are the retained models the same? If not, which seems preferable?</p></li>
<li><p>Analyze the residuals of the model selected in the previous question through graphical representations and by performing tests of homoscedasticity and non-correlation of residuals. Do all the assumptions of a linear model seem to be verified?</p></li>
<li><p>In order to solve the problem of auto-correlation of residuals, we propose to add the previous day’s ozone maximum to the model. Create this variable, which we will call maxO3v and add it to the dataset. Do we observe a linear relationship between maxO3 and maxO3v?</p></li>
<li><p>Fit the regression model containing maxO3v as an additional explanatory variable. Analyze the fitting results: are the assumptions of a linear model verified?</p></li>
<li><p>Compare this last model to the model without maxO3v using a Fisher test and by comparing the different selection criteria (AIC, BIC, Mallows’ Cp, adjusted <span class="math inline">\(R^2\)</span>).</p></li>
</ol>
</section>
<section id="exercise-8.-comparison-of-model-selection-criteria" class="level1">
<h1>Exercise 8. Comparison of Model Selection Criteria</h1>
<p>Consider a linear regression model aimed at explaining <span class="math inline">\(Y\)</span> as a function of variables <span class="math inline">\(X^{(1)}, \ldots, X^{(p)}\)</span>. We want to choose between the model with <span class="math inline">\(X^{(p)}\)</span> and the model without <span class="math inline">\(X^{(p)}\)</span> (the other variables being included in both cases), based on a sample of <span class="math inline">\(n\)</span> individuals.</p>
<p>We denote <span class="math inline">\(F\)</span> the statistic: <span class="math display">\[F = (n - p) \frac{\text{SSR}_c - \text{SSR}}{\text{SSR}}\]</span> where SSR denotes the sum of squared residuals in the model with <span class="math inline">\(X^{(p)}\)</span>, and <span class="math inline">\(\text{SSR}_c\)</span> denotes the sum of squared residuals in the model without <span class="math inline">\(X^{(p)}\)</span>.</p>
<ol class="incremental" type="1">
<li><p>By applying a Fisher test of nested models, according to which decision rule, based on <span class="math inline">\(F\)</span>, will we choose to include the variable <span class="math inline">\(X^{(p)}\)</span> in the model?</p></li>
<li><p>We recall that the adjusted <span class="math inline">\(R^2\)</span> in a model with <span class="math inline">\(k\)</span> variables and <span class="math inline">\(n\)</span> individuals is defined by <span class="math display">\[R^2_a = 1 - \frac{n - 1}{n - k} \frac{\text{SSR}_k}{\text{SST}}\]</span> where <span class="math inline">\(\text{SSR}_k\)</span> denotes the sum of squared residuals in the model, and SST the total sum of squares.</p>
<p>Show that we will decide to include <span class="math inline">\(X^{(p)}\)</span> according to the adjusted <span class="math inline">\(R^2\)</span> criterion if <span class="math inline">\(F &gt; 1\)</span>.</p></li>
<li><p>We recall that the Mallows’ Cp in a model with <span class="math inline">\(k\)</span> variables and <span class="math inline">\(n\)</span> individuals is defined by <span class="math display">\[C_p = \frac{\text{SSR}_k}{\hat{\sigma}^2} - n + 2k\]</span> where <span class="math inline">\(\text{SSR}_k\)</span> denotes the sum of squared residuals in the model, and <span class="math inline">\(\hat{\sigma}^2\)</span> is an estimator of <span class="math inline">\(\sigma^2\)</span> based on the largest possible model. We will take here <span class="math inline">\(\hat{\sigma}^2 = \text{SSR}/(n - p)\)</span>, where SSR denotes the sum of squared residuals in the model with <span class="math inline">\(X^{(p)}\)</span>.</p>
<p>Show that we will decide to include <span class="math inline">\(X^{(p)}\)</span> according to the Mallows’ Cp criterion if <span class="math inline">\(F &gt; 2\)</span>.</p></li>
<li><p>We recall that the AIC criterion in a model with <span class="math inline">\(k\)</span> variables, with <span class="math inline">\(n\)</span> individuals, with Gaussian residuals, is defined by <span class="math display">\[\text{AIC} = n(1 + \log(2\pi)) + n \log \frac{\text{SSR}_k}{n} + 2(k + 1)\]</span> where <span class="math inline">\(\text{SSR}_k\)</span> denotes the sum of squared residuals in the model.</p>
<p>Show that we will decide to include <span class="math inline">\(X^{(p)}\)</span> according to the AIC criterion if <span class="math inline">\(F &gt; (n - p)(e^{2/n} - 1)\)</span>.</p></li>
<li><p>We recall that the BIC criterion (also sometimes called SBC) in a model with <span class="math inline">\(k\)</span> variables, with <span class="math inline">\(n\)</span> individuals, with Gaussian residuals, is defined by <span class="math display">\[\text{BIC} = n(1 + \log(2\pi)) + n \log \frac{\text{SSR}_k}{n} + \log(n)(k + 1)\]</span> where <span class="math inline">\(\text{SSR}_k\)</span> denotes the sum of squared residuals in the model.</p>
<p>Show that we will decide to include <span class="math inline">\(X^{(p)}\)</span> according to the BIC criterion if <span class="math inline">\(F &gt; (n - p)(e^{\log(n)/n} - 1)\)</span>.</p></li>
<li><p>By admitting that the 95% quantiles of a Fisher distribution with degrees of freedom <span class="math inline">\((1, \nu)\)</span> take their values in the interval <span class="math inline">\([3.8, 5]\)</span> as soon as <span class="math inline">\(\nu &gt; 10\)</span>, rank the previous criteria from the most conservative (i.e., tending to more easily reject the introduction of <span class="math inline">\(X^{(p)}\)</span>) to the least conservative (i.e., tending to more easily accept the introduction of <span class="math inline">\(X^{(p)}\)</span>). You can use a Taylor expansion for the study of the AIC and BIC criteria, assuming that <span class="math inline">\(n\)</span> is sufficiently large.</p></li>
</ol>
</section>
<section id="exercise-9.-over-fitting-probability-of-selection-criteria" class="level1">
<h1>Exercise 9. Over-fitting Probability of Selection Criteria</h1>
<p>We place ourselves in the framework of the previous exercise, but we additionally assume that the variable <span class="math inline">\(X^{(p)}\)</span> is not significant in the model (i.e., its coefficient is zero in the regression) and that the residuals are i.i.d. Gaussian. We admit the results stated in the questions of the previous exercise.</p>
<ol class="incremental" type="1">
<li><p>What distribution does the statistic <span class="math inline">\(F\)</span> follow? Show that when <span class="math inline">\(n \to \infty\)</span>, this distribution is equivalent to a <span class="math inline">\(\chi^2(1)\)</span> distribution.</p></li>
<li><p>When implementing the Fisher test of nested models at level <span class="math inline">\(\alpha \in [0, 1]\)</span>, what is the probability of (wrongly) deciding to include the variable <span class="math inline">\(X^{(p)}\)</span> in the model?</p></li>
<li><p>What does the previous probability tend to if we base the decision on the adjusted <span class="math inline">\(R^2\)</span>?</p></li>
<li><p>Same question if the decision is based on Mallows’ Cp.</p></li>
<li><p>Same question if the decision is based on the AIC criterion.</p></li>
<li><p>Same question if the decision is based on the BIC criterion.</p></li>
<li><p>Which criterion is preferable to choose if we want to minimize the risk of including an extra variable in the model?</p></li>
</ol>
<p><strong>Supplement:</strong> In the opposite situation where <span class="math inline">\(X^{(p)}\)</span> is significant in the model and it is therefore preferable to include it, we can show (but it is more difficult) that by relying on any of the above criteria, the probability of (wrongly) deciding not to include <span class="math inline">\(X^{(p)}\)</span> tends to 0 when <span class="math inline">\(n \to \infty\)</span>.</p>
</section>
<section id="exercise-10.-ancova-return-to-ozone-modeling" class="level1">
<h1>Exercise 10. ANCOVA: Return to Ozone Modeling</h1>
<p>We again consider the “ozone.txt” data studied in Exercise 7. We want to take advantage of the qualitative variables present in the dataset (i.e., the presence or absence of rain, and the main wind direction) to possibly improve the model constructed in Exercise 7.</p>
<ol class="incremental" type="1">
<li><p>We take the model selected in Exercise 7, namely “maxO3” as a function of “T12”, “Ne9”, “Vx9” and “maxO3v” where “maxO3v” represents the maximum ozone concentration from the previous day (create this variable if needed). Fit this model on the data.</p></li>
<li><p>Graphically represent “maxO3” as a function of the presence of rain. Does a relationship seem present? Confirm it by a statistical test.</p></li>
<li><p>Add to the model from the first question the variable “rain” in the most general way possible (i.e., including an interaction with each variable in addition to an effect on the constant). Test the significance of these additions by performing a Fisher test of nested models between this model and the initial model.</p></li>
<li><p>Similarly test the simpler model in which only an additive effect of the “rain” variable is integrated, and not its interactions with the other variables. Is the result in disagreement with the graphical analysis from question 2? How to explain the result?</p></li>
<li><p>Similarly: graphically represent “maxO3” as a function of wind direction and study the relevance of including a wind effect in the initial model.</p></li>
</ol>
</section>
<section id="exercise-11.-generalized-least-squares" class="level1">
<h1>Exercise 11. Generalized Least Squares</h1>
<p>Let a multiple linear regression model <span class="math display">\[Y = X\beta + \varepsilon\]</span> where <span class="math inline">\(\beta \in \mathbb{R}^p\)</span>, <span class="math inline">\(X\)</span> is a matrix of size <span class="math inline">\(n \times p\)</span> and <span class="math inline">\(\varepsilon\)</span> is a random vector of size <span class="math inline">\(n\)</span>, centered. We consider here the situation where the variables <span class="math inline">\(\varepsilon_i\)</span> are no longer homoscedastic and uncorrelated, but generally <span class="math inline">\(\mathbb{V}(\varepsilon) = \Sigma\)</span> where <span class="math inline">\(\Sigma\)</span> is an invertible matrix. We assume in this exercise that <span class="math inline">\(\Sigma\)</span> is known (it should be estimated in practice).</p>
<ol class="incremental" type="1">
<li><p>Specify the matrix <span class="math inline">\(\Sigma\)</span> when the variables <span class="math inline">\(\varepsilon_i\)</span> are uncorrelated but heteroscedastic with variance <span class="math inline">\(\sigma_i^2\)</span> (<span class="math inline">\(i = 1, \ldots, n\)</span>).</p></li>
<li><p>Determine the expectation and the variance of the ordinary least squares estimator <span class="math inline">\(\hat{\beta}\)</span> (in the general case of any matrix <span class="math inline">\(\Sigma\)</span>).</p></li>
<li><p>For <span class="math inline">\(S \in \mathbb{R}^n\)</span> and <span class="math inline">\(T \in \mathbb{R}^n\)</span>, we define the scalar product between <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span> associated with the matrix <span class="math inline">\(\Sigma^{-1}\)</span> by <span class="math inline">\(S^T \Sigma^{-1} T\)</span>, and thus the norm of <span class="math inline">\(T\)</span> associated with <span class="math inline">\(\Sigma^{-1}\)</span> is <span class="math inline">\(\|T\|_\Sigma^2 = T^T \Sigma^{-1} T\)</span>. Show that the explicit form of the generalized least squares estimator <span class="math inline">\(\hat{\beta}_G\)</span> defined as the minimizer of <span class="math inline">\(\|Y - X\beta\|_\Sigma\)</span> is <span class="math display">\[\hat{\beta}_G = (X^T \Sigma^{-1} X)^{-1} X^T \Sigma^{-1} Y\]</span></p>
<p>Deduce its expectation and its variance.</p></li>
<li><p>Show that the covariance matrix between <span class="math inline">\(\hat{\beta}\)</span> and <span class="math inline">\(\hat{\beta}_G\)</span> is equal to the variance-covariance matrix of <span class="math inline">\(\hat{\beta}_G\)</span>. Deduce that <span class="math inline">\(\hat{\beta}_G\)</span> is better than <span class="math inline">\(\hat{\beta}\)</span> in the sense of quadratic cost.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>