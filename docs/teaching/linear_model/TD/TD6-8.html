<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TD2-5 – Emmanuel Pilliat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b4406b7675125bc2ba204020e191172.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-338eaa8bf8d7f1eb506da55f2b711d05.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Emmanuel Pilliat</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/epilliat"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fr.linkedin.com/in/emmanuel-pilliat-18ab2b180"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="incremental">
  <li><a href="#linear-and-generalized-regression---tutorial-6-7-8" id="toc-linear-and-generalized-regression---tutorial-6-7-8" class="nav-link active" data-scroll-target="#linear-and-generalized-regression---tutorial-6-7-8">Linear and Generalized Regression - Tutorial 6-7-8</a>
  <ul class="incremental collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2-the-logistic-model-is-natural" id="toc-exercise-2-the-logistic-model-is-natural" class="nav-link" data-scroll-target="#exercise-2-the-logistic-model-is-natural">Exercise 2 (The logistic model is natural)</a></li>
  <li><a href="#exercise-3-the-logistic-model-is-natural-bis" id="toc-exercise-3-the-logistic-model-is-natural-bis" class="nav-link" data-scroll-target="#exercise-3-the-logistic-model-is-natural-bis">Exercise 3 (The logistic model is natural (bis))</a></li>
  <li><a href="#exercise-4-break-data" id="toc-exercise-4-break-data" class="nav-link" data-scroll-target="#exercise-4-break-data">Exercise 4 (Break data)</a></li>
  <li><a href="#exercise-5-mental-data" id="toc-exercise-5-mental-data" class="nav-link" data-scroll-target="#exercise-5-mental-data">Exercise 5 (Mental data)</a></li>
  <li><a href="#exercise-6-ants-data" id="toc-exercise-6-ants-data" class="nav-link" data-scroll-target="#exercise-6-ants-data">Exercise 6 (Ants data)</a></li>
  <li><a href="#exercise-7-horseshoe-crabs-data" id="toc-exercise-7-horseshoe-crabs-data" class="nav-link" data-scroll-target="#exercise-7-horseshoe-crabs-data">Exercise 7 (Horseshoe Crabs data)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TD2-5</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="linear-and-generalized-regression---tutorial-6-7-8" class="level1">
<h1>Linear and Generalized Regression - Tutorial 6-7-8</h1>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise 1</h2>
<p>The dataset “chdage.txt”, available in Moodle, contains data from 100 patients aged 20 to 69 years (variable <code>age</code>), some of whom have coronary heart disease (variable <code>chd</code> taking values <code>Yes</code> or <code>No</code>).</p>
<ol class="incremental" type="1">
<li><p>Import this data into R as a data.frame. Observe the content of each variable and transform their class if necessary.</p></li>
<li><p>Propose one or more graphical visualization(s) to analyze the potential relationship between the variables <code>chd</code> and <code>age</code>.</p></li>
<li><p>Is a relationship apparent? What simple statistical test would confirm it?</p></li>
<li><p>Let <span class="math inline">\(Y = \mathbb{1}_{\text{chd}=\text{Yes}}\)</span> and <span class="math inline">\(p(x) = \mathbb{P}(Y = 1 \mid \text{age} = x)\)</span>. Give the distribution of <span class="math inline">\(Y\)</span> given that <span class="math inline">\(\text{age} = x\)</span> as a function of <span class="math inline">\(p(x)\)</span>.</p></li>
<li><p>Based on this distribution, give the likelihood of the observations <span class="math inline">\((y_1, \ldots, y_n)\)</span> as a function of <span class="math inline">\((p(x_1), \ldots, p(x_n))\)</span> where <span class="math inline">\(x_i\)</span> denotes the age of individual <span class="math inline">\(i\)</span> and <span class="math inline">\(y_i = 1\)</span> if the latter has coronary heart disease.</p></li>
<li><p>As a first estimate of <span class="math inline">\(p(x)\)</span>, we implement the following approach:</p>
<ol class="incremental" type="a">
<li><p>Use the 8 age groups proposed via the variable <code>agegrp</code> in the dataset, which forms 8 groups of individuals associated with these classes. Calculate <span class="math inline">\(\bar{x}_1, \ldots, \bar{x}_8\)</span>, the midpoint of each age class.</p></li>
<li><p>Calculate the proportions of <code>chd = Yes</code> in each group, denoted <span class="math inline">\(\hat{p}_1, \ldots, \hat{p}_8\)</span> (one can use the functions <code>table</code> and <code>prop.table</code>).</p></li>
</ol></li>
<li><p>To analyze the quality of the previous estimate, transform the variable <code>chd</code> into a numerical variable taking the two values 0 and 1, and represent on the same graph the scatter plot of <code>age</code> and <code>chd</code> (recoded) and the estimated proportions in each class <span class="math inline">\((\bar{x}_k, \hat{p}_k)\)</span> for <span class="math inline">\(k = 1, \ldots, 8\)</span>.</p>
<p>What are the virtues and limitations of this estimation procedure?</p></li>
<li><p>We decide to model <span class="math inline">\(p(x)\)</span> using a logistic regression model with parameter <span class="math inline">\(\beta = (\beta_0, \beta_1) \in \mathbb{R}^2\)</span>. What hypothesis does this imply about the expression of <span class="math inline">\(p(x)\)</span>? Is this compatible with the previous graph? What other modeling alternative(s) could we suggest?</p></li>
<li><p>Write the log-likelihood of the logistic model as a function of <span class="math inline">\(\beta\)</span> and deduce the system that the maximum likelihood estimator <span class="math inline">\(\hat{\beta}\)</span> must solve. Can this system be solved analytically?</p></li>
<li><p>Calculate the maximum likelihood estimator using the <code>glm</code> function.</p></li>
<li><p>Recall the theoretical definition of the odds ratio of having coronary heart disease between an individual of age <span class="math inline">\(x_1\)</span> and an individual of age <span class="math inline">\(x_2\)</span>. What is its value for the previous model when the 2 individuals are 10 years apart (that is, <span class="math inline">\(x_1 = x_2 + 10\)</span>)?</p></li>
<li><p>We are now interested in the probability ratio (not the odds ratio) of having coronary heart disease between an individual of age <span class="math inline">\(x_1\)</span> and an individual of age <span class="math inline">\(x_2\)</span>. What is this ratio for the previous model when the 2 individuals are 10 years apart (that is, <span class="math inline">\(x_1 = x_2 + 10\)</span>)? We can represent this ratio as a function of <span class="math inline">\(x_2\)</span>, for <span class="math inline">\(x_2\)</span> taking values from 20 to 70 years.</p></li>
</ol>
<p>We recall that under “good conditions”, the maximum likelihood estimator <span class="math inline">\(\hat{\beta}\)</span> in a logistic regression model with <span class="math inline">\(p\)</span> explanatory variables and <span class="math inline">\(n\)</span> individuals satisfies the following convergence in distribution, when <span class="math inline">\(n \to \infty\)</span>,</p>
<p><span class="math display">\[J_n(\beta)^{1/2} (\hat{\beta} - \beta) \xrightarrow{\mathcal{L}} \mathcal{N}(0_p, I_p),\]</span></p>
<p>where <span class="math inline">\(J_n(\beta)\)</span> is the Fisher information matrix. The latter has the expression</p>
<p><span class="math display">\[J_n(\beta) = X^T W_\beta X\]</span></p>
<p>where <span class="math inline">\(X\)</span> is the design matrix and <span class="math inline">\(W_\beta\)</span> is the diagonal matrix</p>
<p><span class="math display">\[W_\beta = \begin{pmatrix}
p_\beta(x_1)(1 - p_\beta(x_1)) &amp; 0 &amp; &amp; \\
0 &amp; \ddots &amp; &amp; \\
&amp; &amp; \ddots &amp; 0 \\
&amp; &amp; 0 &amp; p_\beta(x_n)(1 - p_\beta(x_n))
\end{pmatrix}.\]</span></p>
<ol class="incremental" start="13" type="1">
<li><p>Justify that an asymptotic approximation of the distribution of <span class="math inline">\((\hat{\beta} - \beta)\)</span> is <span class="math inline">\(\mathcal{N}(0_p, J_n^{-1}(\beta))\)</span>.</p></li>
<li><p>How can we exploit this result to estimate the standard deviation of each coordinate of <span class="math inline">\(\hat{\beta}\)</span>? Give the concrete procedure to apply, but it is not required to implement it numerically.</p></li>
<li><p>This estimation procedure is used by the <code>glm</code> function. Using its output, give an estimate of the standard deviation of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>.</p></li>
<li><p>Construct an asymptotic 95% confidence interval for the parameter <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>According to the previous question, is the parameter <span class="math inline">\(\beta_1\)</span> different from 0 at the 5% asymptotic error level? What is the name of this test procedure? Give the p-value associated with this test and verify that it agrees with the output of <code>glm</code>.</p></li>
<li><p>Calculate the deviance test statistic for the significance of the GLM model (relative to the null model). Deduce the p-value and conclude at the 10%, 5%, and 1% error levels. Compare with the results of the test performed in R using the <code>anova</code> function applied to the model, with the option <code>test="Chisq"</code>.</p></li>
<li><p>Repeat the graph from question 7 and superimpose (in the form of a curve) the predicted values <span class="math inline">\(\hat{p}(x)\)</span> by the logistic model, calculated for a grid of values of <span class="math inline">\(x\)</span> covering the range taken by the observations. One can use the <code>predict</code> function associated with the option <code>type="response"</code>.</p></li>
<li><p>Starting from the convergence in distribution of <span class="math inline">\(\hat{\beta}\)</span> recalled above, deduce a confidence interval at the 95% asymptotic level for <span class="math inline">\(p(x)\)</span>. Add this confidence interval for each <span class="math inline">\(x\)</span> considered to the previous graph. One can profitably exploit the option <code>se=TRUE</code> of the <code>predict</code> function in the case <code>type="link"</code>.</p></li>
</ol>
</section>
<section id="exercise-2-the-logistic-model-is-natural" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-the-logistic-model-is-natural">Exercise 2 (The logistic model is natural)</h2>
<p>We have a pair of random variables <span class="math inline">\((X, Y)\)</span> where <span class="math inline">\(Y\)</span> is binary and <span class="math inline">\(X\)</span> takes values in <span class="math inline">\(\mathbb{R}^d\)</span>. We denote <span class="math inline">\(p = \mathbb{P}(Y = 1)\)</span>, <span class="math inline">\(f_0(\cdot)\)</span> the conditional density of <span class="math inline">\(X\)</span> given that <span class="math inline">\(Y = 0\)</span> and <span class="math inline">\(f_1(\cdot)\)</span> the conditional density of <span class="math inline">\(X\)</span> given that <span class="math inline">\(Y = 1\)</span>. We further denote</p>
<p><span class="math display">\[h(x) = \log \frac{f_1(x)}{f_0(x)} + \log \frac{p}{1 - p}, \quad x \in \mathbb{R}^d.\]</span></p>
<ol class="incremental" type="1">
<li>Show that for all <span class="math inline">\(x\)</span></li>
</ol>
<p><span class="math display">\[\mathbb{P}(Y = 1 \mid X = x) = \frac{1}{1 + e^{-h(x)}}.\]</span></p>
<ol class="incremental" start="2" type="1">
<li><p>Recall that a distribution on <span class="math inline">\(\mathbb{R}^d\)</span> belongs to the exponential family if its density can be written as <span class="math inline">\(a(x)b(\theta)e^{\theta^T T(x)}\)</span>, for some parameter <span class="math inline">\(\theta \in \mathbb{R}^q\)</span>, where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are positive functions and <span class="math inline">\(T : \mathbb{R}^d \to \mathbb{R}^q\)</span> is a function called the sufficient statistic.</p>
<p>Show that if the conditional densities <span class="math inline">\(f_0\)</span> and <span class="math inline">\(f_1\)</span> belong to the same exponential family and differ only in the value of their associated parameter, then <span class="math inline">\(\mathbb{P}(Y = 1 \mid X = x)\)</span> follows exactly a logistic regression model, specifying the parameter and variables.</p></li>
</ol>
</section>
<section id="exercise-3-the-logistic-model-is-natural-bis" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-the-logistic-model-is-natural-bis">Exercise 3 (The logistic model is natural (bis))</h2>
<p><strong>Preamble:</strong> Entropy is a quantity found in thermodynamics to measure the state of disorder or randomness of a system. In the same spirit, it is also found in information theory and probability to quantify the disorder or amount of randomness that a probability distribution incorporates. A physical system tends to naturally evolve towards a state of maximum entropy. Following this principle, it is natural, to describe a given random experiment, to choose probability distributions that maximize entropy. This is the principle we will apply to seek to best choose <span class="math inline">\(\mathbb{P}(Y = 1)\)</span> when <span class="math inline">\(Y\)</span> is binary.</p>
<p>Mathematically, given <span class="math inline">\(Y\)</span> a binary variable and <span class="math inline">\(p = \mathbb{P}(Y = 1)\)</span>, the entropy of the distribution of <span class="math inline">\(Y\)</span> equals</p>
<p><span class="math display">\[-p \log(p) - (1 - p) \log(1 - p).\]</span></p>
<p>The entropy of a vector of independent binary variables <span class="math inline">\(Y_1, \ldots, Y_n\)</span> is simply the sum of the individual entropies.</p>
<ol class="incremental" type="1">
<li><p>Without any source of constraint, what is the maximum entropy distribution of a binary variable?</p></li>
<li><p>Suppose now that we have a sample of <span class="math inline">\(n\)</span> pairs <span class="math inline">\((Y_i, X_i)\)</span> where <span class="math inline">\(X_i\)</span> is a random variable in <span class="math inline">\(\mathbb{R}^d\)</span>. We denote <span class="math inline">\(p_i(x_i) = \mathbb{P}(Y_i = 1 \mid X_i = x_i)\)</span>, <span class="math inline">\(i = 1, \ldots, n\)</span>.</p>
<p>A priori, without using any information contained in the sample, what are the values of <span class="math inline">\(p_i(x_i)\)</span> that maximize entropy?</p></li>
<li><p>We want to find the <span class="math inline">\(p_i(x_i)\)</span> that maximize entropy while being consistent with the observations. This amounts to including constraints on the possible <span class="math inline">\(p_i(x_i)\)</span>. We choose the constraints:</p></li>
</ol>
<p><span class="math display">\[\sum_{i=1}^n y_i x_i = \sum_{i=1}^n p_i(x_i) x_i.\]</span></p>
<p>(Since <span class="math inline">\(x_i\)</span> is a vector of size <span class="math inline">\(d\)</span>, this is indeed a system of <span class="math inline">\(d\)</span> constraints). These constraints are quite natural: we want the average of the <span class="math inline">\(x_i\)</span> of individuals in the positive group (<span class="math inline">\(y_i = 1\)</span>) to coincide with the average of the <span class="math inline">\(x_i\)</span> weighted by the probability that <span class="math inline">\(y_i\)</span> equals 1. In particular (for the constant variable 1), we want the proportion of <span class="math inline">\(y_i = 1\)</span> to coincide with the sum of probabilities.</p>
<p>Find the <span class="math inline">\(p_i(x_i)\)</span> that maximize entropy while satisfying the previous constraints. One can give the solution up to an unknown (vector) constant.</p>
<ol class="incremental" start="4" type="1">
<li>What is the connection with logistic regression?</li>
</ol>
</section>
<section id="exercise-4-break-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-break-data">Exercise 4 (Break data)</h2>
<p>We consider the <code>break</code> data, available on the Moodle course page. This dataset, of size <span class="math inline">\(n = 33\)</span>, contains three variables related to the state of an automobile:</p>
<ul class="incremental">
<li>A variable <code>fault</code> that equals 1 if the car concerned had a breakdown, 0 otherwise;</li>
<li>A variable <code>age</code> that gives the age of the car;</li>
<li>A variable <code>brand</code> that gives the brand of the car.</li>
</ul>
<p>The goal of the exercise is to model the variable <code>fault</code>.</p>
<ol class="incremental" type="1">
<li><p>Import the data into R and recode the class of each variable if necessary.</p></li>
<li><p>Graphically observe the potential relationship between <code>fault</code> and <code>age</code> on the one hand, and between <code>fault</code> and <code>brand</code> on the other hand.</p></li>
<li><p>We want to implement a logistic regression model explaining the probability of having a breakdown as a function of the car’s age and its brand. Launch this modeling in R and write the mathematical formula of the obtained model. In particular, specify the specific estimated model for cars of brand 0, then brand 1, then brand 2.</p></li>
<li><p>Analyze the overall quality of the model.</p></li>
<li><p>Repeat the modeling including only the variable <code>age</code> in the model. Is it better?</p></li>
<li><p>The scatter plot between the variable <code>age</code> and the variable <code>fault</code> seems to suggest that breakdowns occur at the beginning of the vehicle’s life (“teething problems” or “break-in”) and at the end of life (wear breakdowns). This behavior of the breakdown probability in the form of a parabola encourages us to try to include a quadratic term in the variable <code>age</code>. Make this addition to the model also including the variable <code>brand</code> and analyze the results. Is the model significant?</p></li>
<li><p>What is the odds ratio associated with brand “2” relative to brand “0” of the variable <code>brand</code>? Interpret this value and give a 95% confidence interval around this estimate. Is the inclusion of the variable <code>brand</code> in the model relevant?</p></li>
</ol>
</section>
<section id="exercise-5-mental-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5-mental-data">Exercise 5 (Mental data)</h2>
<p>We consider the <code>mental</code> data, contained in the file <code>mental.txt</code> available on the Moodle course page. This dataset, of size <span class="math inline">\(n = 40\)</span>, is extracted from a study on the mental health of adults living in Alachua County, Florida, USA. It contains three variables:</p>
<ul class="incremental">
<li>A variable <code>impair</code> describing the mental state of the person concerned, from 1 (healthy) to 4 (in poor health),</li>
<li>A variable <code>ses</code> that equals 1 if the person has a high socioeconomic status, 0 otherwise,</li>
<li>A variable <code>life</code> measuring the number and intensity of upheavals the person has experienced over the past three years, from 0 (no change) to 9 (very significant changes).</li>
</ul>
<p>The goal of the exercise is to model the variable <code>impair</code>.</p>
<ol class="incremental" type="1">
<li><p>Import the data into R. Is the variable <code>ses</code> qualitative or quantitative? Same question for the variable <code>life</code>. Change their class in R if needed.</p></li>
<li><p>Perform a small descriptive study to identify a potential relationship between the variable <code>impair</code> and the other variables in the dataset.</p></li>
<li><p>Mathematically write the proportional cumulative logistic regression model without interaction term linking <code>impair</code> to <code>ses</code> and <code>life</code>, and allowing estimation of the probabilities that <code>impair = 1</code>, <code>≤ 2</code> and <code>≤ 3</code>. How many coefficients does this model have?</p></li>
<li><p>Estimate the coefficients of this model using the <code>vglm</code> function from the <code>VGAM</code> package, associated with the option <code>family = cumulative(parallel=TRUE)</code>. Check that the number of coefficients is indeed as expected.</p></li>
<li><p>Write the mathematical definition of the odds ratio associated with the variable <code>ses</code> and interpret this quantity.</p></li>
<li><p>Give an asymptotic 95% confidence interval for the parameter related to the variable <code>ses</code>.</p></li>
<li><p>Deduce an asymptotic 95% confidence interval for the associated odds ratio.</p></li>
<li><p>Is there an influence of socioeconomic status on mental health status at the 5% level? And at the 10% level?</p></li>
<li><p>We want to see if a more complex model would fit the data better. Mathematically write then estimate a proportional cumulative logistic regression model with interaction term. Interpret the obtained result. Is this model significantly better, at the 5% asymptotic error level?</p></li>
<li><p>Same question with a cumulative logistic regression model without proportional structure, but without interaction term.</p></li>
<li><p>Conversely, could we propose a simpler model?</p></li>
<li><p>Finally, we decide not to exploit the fact that the variable <code>impair</code> is ordinal, and to model it by a multinomial logistic model. Compare this approach to the previous modeling.</p></li>
</ol>
</section>
<section id="exercise-6-ants-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6-ants-data">Exercise 6 (Ants data)</h2>
<p>The goal of the study is to study the diversity of ants at the Nouragues experimental site in French Guiana. 1 m² of litter was collected at several locations in 4 different forests (the plateau forest GPWT, the liana forest FLWT, the transition forest FTWT, and the Inselberg forest INWT). Each sample was weighed (variable <code>Weight</code>) and the number of different species present in the sample was recorded (variable <code>Effectif</code>). Finally, the collection conditions (humid or dry, variable <code>Conditions</code>) were noted to test their influence on the presence of ants.</p>
<ol class="incremental" type="1">
<li><p>Import the data into R and transform categorical variables into factors.</p></li>
<li><p>Perform a small descriptive study to identify a potential relationship between the number of observed species and the other available variables.</p></li>
<li><p>Model the variable <code>Effectifs</code> as a function of all available variables by a Poisson log-linear model, including all their possible interactions. Analyze the model output.</p></li>
<li><p>Using the <code>step</code> function, perform a stepwise backward selection of the best sub-model of the previous model according to the AIC criterion, then according to the BIC criterion. Similarly perform a stepwise forward selection. Compare the obtained choices.</p></li>
<li><p>The inconsistency in the previous backward and forward selections suggests that there may be an alternative sub-model (not tested by these algorithms) that is even better. This encourages us to perform an exhaustive selection of the best sub-model, as proposed by the <code>regsubsets</code> function in linear regression. Unfortunately, the latter does not work with the Poisson model. If we wanted to implement this exhaustive selection ourselves, justify that there would be 30 sub-models (with constant) to test, counting the most general model.</p></li>
<li><p>We admit that at the end of such an exhaustive selection, the best sub-model in terms of AIC and BIC is the one whose <code>Weight</code> coefficients are broken down into as many crossed modalities as contained in the factors <code>Site</code> and <code>Conditions</code> (that is, 8), but which has an identical intercept for all crossed modalities of <code>Site</code> and <code>Conditions</code>. Estimate this model, calculate its AIC and BIC and compare with those of the previously selected models.</p></li>
<li><p>As an alternative, we want to try to fit a negative binomial generalized model. If we include all possible interactions, does this approach seem preferable to the Poisson model?</p></li>
<li><p>After an exhaustive selection, we admit that the best negative binomial sub-model in terms of AIC involves the same variables as the best Poisson model. On the other hand, for the BIC criterion, it is the model involving only <code>Weight</code> and <code>Site</code>, in which the coefficient of <code>Weight</code> varies according to <code>Site</code>, but the intercept is constant. Estimate these two models and calculate their AIC and BIC.</p></li>
<li><p>Given the experts’ opinion, it seems important that the model takes into account humidity conditions. What final model should be retained?</p></li>
<li><p>Write the equation of the retained model according to the different sites and collection conditions.</p></li>
<li><p>According to the selected model, what is the probability of observing more than 15 species on an INWT type soil in dry weather, based on a soil sample weighing 10kg? Same question if the weather is humid.</p></li>
</ol>
</section>
<section id="exercise-7-horseshoe-crabs-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7-horseshoe-crabs-data">Exercise 7 (Horseshoe Crabs data)</h2>
<p>The <code>crabs</code> dataset contains observations of 173 female horseshoe crabs. These are marine animals that resemble crabs having a horseshoe shape. For each female horseshoe crab, we record its color <code>color</code> (coded from 1 to 4, from lightest to darkest), its width <code>width</code>, its weight <code>weight</code>, and <code>satell</code>: the number of satellite male horseshoe crabs (that is, attached to the female). Color is a sign of the age of the horseshoe crab, the latter tending to darken over time. We seek to model the number <code>satell</code> as a function of the available variables.</p>
<ol class="incremental" type="1">
<li><p>Implement a Poisson log-linear model and a negative binomial model. Evaluate their quality. In particular, one can discuss the relevance of considering the variable <code>color</code> as a quantitative variable or a factor.</p></li>
<li><p>Improve the modeling by taking into account zero inflation.</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>