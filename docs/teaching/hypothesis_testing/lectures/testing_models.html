<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hypothesis Testing – Emmanuel Pilliat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-2ae6f13666a6fe323f0f1a1a04a8df49.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<link rel="stylesheet" href="../style.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Emmanuel Pilliat</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/epilliat"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fr.linkedin.com/in/emmanuel-pilliat-18ab2b180"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../teaching/hypothesis_testing/lectures/testing_models.html">Hypothesis Testing</a></li><li class="breadcrumb-item"><a href="../../../teaching/hypothesis_testing/lectures/testing_models.html">Testing Models</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Hypothesis Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/hypothesis_testing/lectures/testing_models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Testing Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/hypothesis_testing/lectures/gaussian_populations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Populations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/hypothesis_testing/lectures/goodness_of_fit_chi2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Goodness of Fit, Homogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/hypothesis_testing/lectures/dependency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dependency</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Probability</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/probability/density_likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Density and Likelihood</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Times Series</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="incremental">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="incremental collapse">
  <li><a href="#general-principles" id="toc-general-principles" class="nav-link" data-scroll-target="#general-principles">General Principles</a></li>
  <li><a href="#good-and-bad-decisions" id="toc-good-and-bad-decisions" class="nav-link" data-scroll-target="#good-and-bad-decisions">Good and Bad Decisions</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="incremental collapse">
  <li><a href="#dice-biased-toward-6" id="toc-dice-biased-toward-6" class="nav-link" data-scroll-target="#dice-biased-toward-6">Dice biased toward <span class="math inline">\(6\)</span></a></li>
  <li><a href="#medical-test" id="toc-medical-test" class="nav-link" data-scroll-target="#medical-test">Medical test</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#basics-of-hypothesis-testing" id="toc-basics-of-hypothesis-testing" class="nav-link" data-scroll-target="#basics-of-hypothesis-testing">Basics of Hypothesis Testing</a>
  <ul class="incremental collapse">
  <li><a href="#estimation-vs-test" id="toc-estimation-vs-test" class="nav-link" data-scroll-target="#estimation-vs-test">Estimation VS Test</a>
  <ul class="incremental collapse">
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation">Estimation</a></li>
  <li><a href="#test" id="toc-test" class="nav-link" data-scroll-target="#test">Test</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#type-of-problems" id="toc-type-of-problems" class="nav-link" data-scroll-target="#type-of-problems">Type of Problems</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#parametric-vs-non-parametric" id="toc-parametric-vs-non-parametric" class="nav-link" data-scroll-target="#parametric-vs-non-parametric">Parametric VS Non-Parametric</a></li>
  <li><a href="#decision-rule-and-test-statistic" id="toc-decision-rule-and-test-statistic" class="nav-link" data-scroll-target="#decision-rule-and-test-statistic">Decision Rule and Test Statistic</a></li>
  <li><a href="#rejection-region" id="toc-rejection-region" class="nav-link" data-scroll-target="#rejection-region">Rejection Region</a></li>
  </ul></li>
  <li><a href="#recall-of-proba" id="toc-recall-of-proba" class="nav-link" data-scroll-target="#recall-of-proba">Recall of Proba</a>
  <ul class="incremental collapse">
  <li><a href="#examples-1" id="toc-examples-1" class="nav-link" data-scroll-target="#examples-1">Examples</a>
  <ul class="incremental collapse">
  <li><a href="#gaussianbernoulli" id="toc-gaussianbernoulli" class="nav-link" data-scroll-target="#gaussianbernoulli">Gaussian/Bernoulli</a></li>
  <li><a href="#exponentialgeometric" id="toc-exponentialgeometric" class="nav-link" data-scroll-target="#exponentialgeometric">Exponential/Geometric</a></li>
  <li><a href="#gammapoisson" id="toc-gammapoisson" class="nav-link" data-scroll-target="#gammapoisson">Gamma/Poisson</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#simple-vs-simple-1" id="toc-simple-vs-simple-1" class="nav-link" data-scroll-target="#simple-vs-simple-1">Simple VS Simple</a>
  <ul class="incremental collapse">
  <li><a href="#likelihood-ratio-test" id="toc-likelihood-ratio-test" class="nav-link" data-scroll-target="#likelihood-ratio-test">Likelihood Ratio Test</a></li>
  <li><a href="#neyman-pearson" id="toc-neyman-pearson" class="nav-link" data-scroll-target="#neyman-pearson">Neyman Pearson</a>
  <ul class="incremental collapse">
  <li><a href="#proof-of-neyman-pearsons-theorem" id="toc-proof-of-neyman-pearsons-theorem" class="nav-link" data-scroll-target="#proof-of-neyman-pearsons-theorem">Proof of Neyman Pearson’s theorem</a></li>
  </ul></li>
  <li><a href="#examples-2" id="toc-examples-2" class="nav-link" data-scroll-target="#examples-2">Examples</a>
  <ul class="incremental collapse">
  <li><a href="#example-gaussians" id="toc-example-gaussians" class="nav-link" data-scroll-target="#example-gaussians">Example (Gaussians)</a></li>
  <li><a href="#example-exponential-families" id="toc-example-exponential-families" class="nav-link" data-scroll-target="#example-exponential-families">Example: Exponential Families</a></li>
  <li><a href="#example-radioactive-source" id="toc-example-radioactive-source" class="nav-link" data-scroll-target="#example-radioactive-source">Example: Radioactive Source</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multiple-multiple-tests" id="toc-multiple-multiple-tests" class="nav-link" data-scroll-target="#multiple-multiple-tests">Multiple-Multiple Tests</a>
  <ul class="incremental collapse">
  <li><a href="#generalities" id="toc-generalities" class="nav-link" data-scroll-target="#generalities">Generalities</a></li>
  <li><a href="#multiple-multiple-tests-in-mathbb-r" id="toc-multiple-multiple-tests-in-mathbb-r" class="nav-link" data-scroll-target="#multiple-multiple-tests-in-mathbb-r">Multiple-Multiple Tests in <span class="math inline">\(\mathbb R\)</span></a></li>
  </ul></li>
  <li><a href="#pivotal-test-statistic-and-p-value" id="toc-pivotal-test-statistic-and-p-value" class="nav-link" data-scroll-target="#pivotal-test-statistic-and-p-value">Pivotal Test Statistic and P-value</a>
  <ul class="incremental collapse">
  <li><a href="#pivotal-test-statistic" id="toc-pivotal-test-statistic" class="nav-link" data-scroll-target="#pivotal-test-statistic">Pivotal Test Statistic</a></li>
  <li><a href="#p-value" id="toc-p-value" class="nav-link" data-scroll-target="#p-value">P-value</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../teaching/hypothesis_testing/lectures/testing_models.html">Hypothesis Testing</a></li><li class="breadcrumb-item"><a href="../../../teaching/hypothesis_testing/lectures/testing_models.html">Testing Models</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Hypothesis Testing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Tests provide the theoretical basis for decision-making based on data. For example, doctors diagnose diseases using specific biological markers, industrial quality engineers evaluate the quality of a production batch, and climate scientists determine whether there are significant changes in measurements compared to the pre-industrial era.</p>
<section id="general-principles" class="level2">
<h2 class="anchored" data-anchor-id="general-principles">General Principles</h2>
<p><strong>Hypothesis testing</strong> is a key statistical method that enables professionals to make informed decisions. The process involves setting up two competing hypotheses:</p>
<ul class="incremental">
<li>the <strong>null hypothesis <span class="math inline">\(H_0\)</span></strong>, which assumes no effect or no difference. This is usually an a priori on the data.</li>
<li>the <strong>alternative hypothesis <span class="math inline">\(H_1\)</span></strong>, which suggests that there is a significant effect or difference.</li>
</ul>
<p>Let’s illustrate this with the example of a doctor diagnosing a disease, such as diabetes, using blood glucose levels:</p>
<ul class="incremental">
<li>The doctor begins by assuming the <strong>null hypothesis <span class="math inline">\(H_0\)</span></strong>: the patient’s blood glucose levels are normal, indicating no diabetes.</li>
<li>The <strong>alternative hypothesis (<span class="math inline">\(H_1\)</span>)</strong> would suggest that the patient’s glucose levels are abnormally high, indicating diabetes.</li>
</ul>
<p>After collecting the patient’s blood glucose data, the doctor compares it to a standard threshold for diagnosing diabetes. A hypothesis test is then performed to evaluate whether the observed glucose level is significantly higher than the threshold, or whether the difference could simply be due to random variation.</p>
<p>The testing process can be summarized as follows:</p>
<ol class="incremental" type="1">
<li><strong>Fix an objective:</strong> test whether Bob has diabetes</li>
<li><strong>Design an experiment:</strong> measure of glucose level</li>
<li><strong>Define hypotheses</strong>
<ul class="incremental">
<li><strong>Null hypothesis:</strong> <span class="math inline">\(H_0\)</span>: a priori, Bob has no diabetes</li>
<li><strong>Alternative hypothesis:</strong> <span class="math inline">\(H_1\)</span>: Bob has diabete</li>
</ul></li>
<li><strong>Define a decision dule:</strong> function of the glucose level</li>
<li><strong>Collect data:</strong> do the measure of glucose level</li>
<li><strong>Apply the decision rule:</strong> reject <span class="math inline">\(H_0\)</span> or not</li>
<li><strong>Draw a conclusion:</strong> should Bob follow a treatment or make other tests?</li>
</ol>
</section>
<section id="good-and-bad-decisions" class="level2">
<h2 class="anchored" data-anchor-id="good-and-bad-decisions">Good and Bad Decisions</h2>
<table style="border-collapse: collapse; width: 100%; text-align: center; border: 2px solid black;">
<thead>
<tr>
<th>
Decision
</th>
<th>
<span class="math inline">\(H_0\)</span> True
</th>
<th>
<span class="math inline">\(H_1\)</span> True
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<span class="math inline">\(T=0\)</span>
</td>
<td class="fragment green-cell" data-fragment-index="1">
True Negative (<strong>TN</strong>)
</td>
<td class="fragment red-cell">
False Negative (<strong>FN</strong>)
<ul style="list-style-position: inside; margin: 0; padding: 0;">
<li>
Second Type Error
</li>
<li>
Missed Detection
</li>
</ul>
</td>
</tr>
<tr>
<td>
<span class="math inline">\(T=1\)</span>
</td>
<td class="fragment red-cell">
False Positive (<strong>FP</strong>)
<ul style="list-style-position: inside; margin: 0; padding: 0;">
<li>
First Type Error
</li>
<li>
False Alarm
</li>
</ul>
</td>
<td class="fragment green-cell">
True Positive (<strong>TP</strong>)
</td>
</tr>
</tbody>
</table>
<p>In general, observing <span class="math inline">\(T=1\)</span> is just <em>one piece of evidence</em> supporting <span class="math inline">\(H_1\)</span>. It’s possible that we were simply unlucky and the data led the test to reject <span class="math inline">\(H_0\)</span>. Additionally, the sample used might not be representative, or the elevated glucose level could be caused by another condition, not diabetes. Therefore, we cannot blindly accept <span class="math inline">\(H_1\)</span> based on this result alone. Further investigation is essential when <span class="math inline">\(T=1\)</span> to minimize the risk of making a Type I error.</p>
<p>The same applies when <span class="math inline">\(T=0\)</span>. A result of <span class="math inline">\(T=0\)</span> simply indicates that the test provides no evidence in favor of <span class="math inline">\(H_1\)</span>, but it doesn’t mean that <span class="math inline">\(H_1\)</span> is false. It is possible that the patient exhibits other symptoms that could still suggest a diagnosis of diabetes, despite the lack of evidence from the test.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="dice-biased-toward-6" class="level3">
<h3 class="anchored" data-anchor-id="dice-biased-toward-6">Dice biased toward <span class="math inline">\(6\)</span></h3>
<ol class="incremental" type="1">
<li><strong>Objective</strong>: test if Bob is cheating with a dice.<br>
</li>
<li><strong>Experiment</strong>: Bob rolls the dice <span class="math inline">\(10\)</span> times.</li>
<li><strong>Hypotheses</strong>:
<ul class="incremental">
<li><span class="math inline">\(H_0\)</span>: the probability of getting <span class="math inline">\(6\)</span> is <span class="math inline">\(1/6\)</span></li>
<li><span class="math inline">\(H_1\)</span>: the probability of getting <span class="math inline">\(6\)</span> is larger than <span class="math inline">\(1/6\)</span></li>
</ul></li>
<li><strong>Decision rule</strong>: the probability of getting a number of <span class="math inline">\(6\)</span> at least equal to the number of observed <span class="math inline">\(6\)</span> is <span class="math inline">\(&lt; 0.05\)</span></li>
<li><strong>Data</strong>: the dice falls <span class="math inline">\(10\)</span> times on <span class="math inline">\(6\)</span></li>
<li><strong>Decision</strong>: the probability is <span class="math inline">\(1/6^{10} &lt; 0.05\)</span></li>
<li><strong>Conclusion?</strong></li>
</ol>
<p>In the above example, we formally observe <span class="math inline">\((X_1, \dots, X_n)\)</span> iid where <span class="math inline">\(X_i \in \{1, \dots, 6\}\)</span> where each <span class="math inline">\(\mathbb P(X_i = k) = p_k\)</span> Imagine that instead of ten <span class="math inline">\(6\)</span>, we observed <span class="math inline">\(600\)</span> tosses leading to the following counts:</p>
<p><img src="../images/biased_dice.svg" class="img-fluid" style="width:80.0%"></p>
<p>The number of <span class="math inline">\(6\)</span> is really close to <span class="math inline">\(100 = 600/6\)</span>, which implies that we would not reject <span class="math inline">\(H_0\)</span> in the previous example. We would reject however if we wanted to test whether the dice is fair, since it is highly biased toward <span class="math inline">\(2\)</span>.</p>
<div class="fragment callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Same data, two conclusions
</div>
</div>
<div class="callout-body-container callout-body">
<div class="columns">
<div class="column">
<ul class="incremental">
<li><span class="math inline">\(H_0: p_6 = 1/6\)</span> VS <span class="math inline">\(H_1: p_6 &gt; 1/6\)</span></li>
<li>Do not reject <span class="math inline">\(H_1\)</span> (<span class="math inline">\(H_0\)</span> is “likely”)</li>
</ul>
</div><div class="column">
<ul class="incremental">
<li><span class="math inline">\(H_0: (p_1=\dots=p_6 = 1/6)\)</span> (dice is fair) VS <span class="math inline">\(H_1: \exists k: p_k &gt; 1/6\)</span></li>
<li>Reject <span class="math inline">\(H_1\)</span> (<span class="math inline">\(H_0\)</span> is “unlikely”)</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="medical-test" class="level3">
<h3 class="anchored" data-anchor-id="medical-test">Medical test</h3>
<p>See also the (<a href="../pluto/illustration_pvalue.html">Pluto notebook: illustration of pvalue</a>)</p>
<ol class="incremental" type="1">
<li><strong>Objective:</strong> test if a fetus has Down syndrome</li>
<li><strong>Experiment:</strong> measure the Nucal translucency</li>
<li><strong>Hypotheses:</strong>
<ul class="incremental">
<li><span class="math inline">\(H_0\)</span>: nucal translucency is normal <span class="math inline">\(\sim \mathcal N(1.5,0.8)\)</span></li>
<li><span class="math inline">\(H_1\)</span>: nucal translucency is large</li>
</ul></li>
<li><strong>Decision rule</strong>: reject if <span class="math inline">\(P_0(X \geq x_{obs}) \leq 0.05\)</span> (“<span class="math inline">\(95^{th}\)</span> percentile”)</li>
<li><strong>Collect data</strong>: <span class="math inline">\(x_{obs}=3.02\)</span></li>
<li><strong>Make a decision</strong>: Calculate the value of <span class="math inline">\(P_0(X \geq 3.02)=0.029\)</span></li>
<li><strong>Conclusion?</strong></li>
</ol>
<p><img src="../images/nuque.svg" class="fragment img-fluid" style="width:80.0%"></p>
</section>
</section>
</section>
<section id="basics-of-hypothesis-testing" class="level1">
<h1>Basics of Hypothesis Testing</h1>
<section id="estimation-vs-test" class="level2">
<h2 class="anchored" data-anchor-id="estimation-vs-test">Estimation VS Test</h2>
<ul class="incremental">
<li>We observe some data <span class="math inline">\(X\)</span> in a measurable space <span class="math inline">\((\mathcal X, \mathcal A)\)</span>.</li>
<li>Example <span class="math inline">\(\mathcal X = \mathbb R^n\)</span>: <span class="math inline">\(X= (X_1, \dots, X_n)\)</span>.</li>
</ul>
<section id="estimation" class="level3">
<h3 class="anchored" data-anchor-id="estimation">Estimation</h3>
<ul class="incremental">
<li>One set of distributions <span class="math inline">\(\mathcal P\)</span></li>
<li>Parameterized by <span class="math inline">\(\Theta\)</span> <span class="math display">\[
\mathcal P = \{P_{\theta},~ \theta \in \Theta\} \; .
\]</span></li>
<li><span class="math inline">\(\exists \theta \in \Theta\)</span> such that <span class="math inline">\(X \sim P_{\theta}\)</span></li>
</ul>
<p><strong>Goal:</strong> estimate a given function of <span class="math inline">\(P_{\theta}\)</span>, e.g.:</p>
<ul class="incremental">
<li><span class="math inline">\(F(P_{\theta}) = \int x dP_{\theta}\)</span></li>
<li><span class="math inline">\(F(P_{\theta}) = \int x^2 dP_{\theta}\)</span></li>
</ul>
</section>
<section id="test" class="level3">
<h3 class="anchored" data-anchor-id="test">Test</h3>
<ul class="incremental">
<li><p>Two sets of distributions <span class="math inline">\(\mathcal P_0\)</span>, <span class="math inline">\(\mathcal P_1\)</span></p></li>
<li><p>Parameterized by disjoints <span class="math inline">\(\Theta_0\)</span>, <span class="math inline">\(\Theta_1\)</span> <span class="math display">\[
\begin{aligned}
\mathcal P_0 = \{P_{\theta} : \theta \in \Theta_1\}, ~~~~  \mathcal P_1 = \{P_{\theta} : \theta \in \Theta_1\}\; .
\end{aligned}
\]</span></p></li>
<li><p><span class="math inline">\(\exists \theta \in \Theta_0 \cup \Theta_1\)</span> such that <span class="math inline">\(X \sim P_{\theta}\)</span></p></li>
</ul>
<p><strong>Goal:</strong> decide between <span class="math display">\[H_0: \theta \in \Theta_0 \text{ or } H_1: \theta \in \Theta_1\]</span></p>
</section>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="columns">
<div class="column" style="width:50%;">
<section id="estimation-1" class="level3">
<h3 class="anchored" data-anchor-id="estimation-1">Estimation</h3>
<div class="fragment">
<p><img src="../images/estim.png" class="img-fluid" style="width:120.0%"></p>
</div>
</section>
</div><div class="column" style="width:50%;">
<section id="test-1" class="level3">
<h3 class="anchored" data-anchor-id="test-1">Test</h3>
<div class="fragment">
<p><img src="../images/test_intro.png" class="img-fluid"></p>
</div>
</section>
</div>
</div>
</section>
<section id="type-of-problems" class="level2">
<h2 class="anchored" data-anchor-id="type-of-problems">Type of Problems</h2>
<ul class="incremental">
<li><strong>Simple VS Simple</strong>:<span class="math display">\[\Theta_0 = \{\theta_0\} \text{ and } \Theta_1 = \{\theta_1\}\]</span></li>
<li><strong>Simple VS Multiple</strong>:<span class="math display">\[\Theta_0 = \{\theta_0\}\]</span></li>
<li>Else: <strong>Multiple VS Multiple</strong></li>
</ul>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<div class="columns">
<div class="column" style="width:50%;">
<section id="simple-vs-simple" class="level3">
<h3 class="anchored" data-anchor-id="simple-vs-simple">Simple VS Simple</h3>
<div class="fragment">
<p><img src="../images/simple-simple.svg" class="img-fluid"></p>
</div>
</section>
</div><div class="column" style="width:50%;">
<section id="multiple-vs-multiple" class="level3">
<h3 class="anchored" data-anchor-id="multiple-vs-multiple">Multiple VS Multiple</h3>
<div class="fragment">
<p><img src="../images/test_intro.png" class="img-fluid"></p>
</div>
</section>
</div>
</div>
</section>
<section id="parametric-vs-non-parametric" class="level2">
<h2 class="anchored" data-anchor-id="parametric-vs-non-parametric">Parametric VS Non-Parametric</h2>
<ul class="incremental">
<li><strong>Parametric</strong>: <span class="math inline">\(\Theta_0\)</span> and <span class="math inline">\(\Theta_1\)</span> included in subspaces of finite dimension.</li>
<li><strong>Non-parametric</strong>: otherwise</li>
</ul>
<div class="fragment">
<p>Example of multiple VS multiple parametric problem:</p>
<ul class="incremental">
<li><span class="math inline">\(H_0: X \sim \mathcal N(\theta,\sigma)\)</span>, unknown <span class="math inline">\(\theta &lt; 0\)</span> and unknown <span class="math inline">\(\sigma &gt; 0\)</span>: <span class="math inline">\(\Theta_0 \subset \mathbb R^2\)</span></li>
<li><span class="math inline">\(H_1: X \sim \mathcal N(\theta,\sigma)\)</span>, unknown <span class="math inline">\(\theta &gt; 0\)</span> and unknown <span class="math inline">\(\sigma &gt; 0\)</span>: <span class="math inline">\(\Theta_1 \subset \mathbb R^2\)</span></li>
</ul>
</div>
</section>
<section id="decision-rule-and-test-statistic" class="level2">
<h2 class="anchored" data-anchor-id="decision-rule-and-test-statistic">Decision Rule and Test Statistic</h2>
<div class="callout callout-style-default callout-note callout-titled" title="Decision rule">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Decision rule
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="incremental">
<li><p>A <strong>decision rule</strong> or <strong>test</strong> <span class="math inline">\(T\)</span> is a measurable function from <span class="math inline">\(\mathcal X\)</span> to <span class="math inline">\(\{0,1\}\)</span>: <span class="math display">\[ T : \mathcal X \to \{0,1\}\; .\]</span></p></li>
<li><p>It can depend on the sets <span class="math inline">\(\mathcal P_0\)</span> and <span class="math inline">\(\mathcal P_1\)</span></p></li>
<li><p>but <strong>not</strong> on any unknown parameter.</p></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Test statistic">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Test statistic
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="incremental">
<li><p>a <strong>test statistic</strong> <span class="math inline">\(\psi\)</span> is a measurable function from <span class="math inline">\(\mathcal X\)</span> to <span class="math inline">\(\mathbb R\)</span>: <span class="math display">\[ \psi : \mathcal X \to \mathbb R\; .\]</span></p></li>
<li><p>It can depend on the sets <span class="math inline">\(\mathcal P_0\)</span> and <span class="math inline">\(\mathcal P_1\)</span></p></li>
</ul>
</div>
</div>
</section>
<section id="rejection-region" class="level2">
<h2 class="anchored" data-anchor-id="rejection-region">Rejection Region</h2>
<ul class="incremental">
<li>For a given test <span class="math inline">\(T\)</span>, the <strong>rejection region</strong> <span class="math inline">\(\mathcal R \subset \mathbb R\)</span> is the set <span class="math display">\[\{\psi(x) \in \mathbb R:~ T(x)=1\} \; .\]</span></li>
<li>Example of <span class="math inline">\(\mathcal R\)</span>, for a given threshold <span class="math inline">\(t&gt;0\)</span>, <span class="math display">\[
\begin{aligned}
T(x) &amp;= \mathbf{1}\{\psi(x) &gt; t\}:~~~~~~\mathcal R = (t,+\infty)\\
T(x) &amp;= \mathbf{1}\{\psi(x) &lt; t\}:~~~~~~\mathcal R = (-\infty,t)\\
T(x) &amp;= \mathbf{1}\{|\psi(x)| &gt; t\}:~~~~~~\mathcal R = (-\infty,t)\cup (t, +\infty)\\
T(x) &amp;= \mathbf{1}\{\psi(x) \not \in [t_1, t_2]\}:~~~~~~\mathcal R = (-\infty,t_1)\cup (t_2, +\infty)\;
\end{aligned}
\]</span></li>
</ul>
</section>
</section>
<section id="recall-of-proba" class="level1">
<h1>Recall of Proba</h1>
<p>Consider a probability measure <span class="math inline">\(P\)</span> on <span class="math inline">\(\mathbb R\)</span>.</p>
<ul class="incremental">
<li><strong>CDF</strong> (cumulative distribution function): <span class="math display">\[x \to P(~(-\infty,x]~) = \mathbb P(X \leq x) ~~~~\text{(if $X \sim P$ under $\mathbb P$)}\]</span></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<section id="continous-measures" class="level2">
<h2 class="anchored" data-anchor-id="continous-measures">Continous Measures</h2>
<ul class="incremental">
<li><p>density wrp to Lebesgue: <span class="math inline">\(dP(x) = p(x)dx\)</span></p></li>
<li><p><strong>PDF</strong> (proba density function): <span class="math inline">\(x \to p(x)\)</span></p></li>
<li><p><strong>CDF</strong>: <span class="math inline">\(x \to \int_{\infty}^x p(x')dx'\)</span></p></li>
<li><p><span class="math inline">\(\alpha\)</span>-quantile <span class="math inline">\(q_{\alpha}\)</span>: <span class="math inline">\(\int_{\infty}^{q_{\alpha}} p(x)dx = \alpha\)</span></p></li>
<li><p>or <span class="math inline">\(\mathbb P(X \leq q_{\alpha} = \alpha)\)</span></p></li>
</ul>
</section>
</div><div class="column" style="width:50%;">
<div class="fragment">
<section id="discrete-measures" class="level2">
<h2 class="anchored" data-anchor-id="discrete-measures">Discrete Measures</h2>
<ul class="incremental">
<li>density wrp to counting measure: <span class="math inline">\(P(X=x) = p(x)\)</span></li>
<li><strong>CDF</strong>: <span class="math inline">\(x \to \sum_{x' \leq x} p(x')dx'\)</span></li>
<li><span class="math inline">\(\alpha\)</span>-quantile <span class="math inline">\(q_{\alpha}\)</span>: <span class="math display">\[\inf_{q \in \mathbb R}\{q:~\sum_{x_i \leq q}p(x_i) &gt; \alpha\}\]</span></li>
</ul>
</section>
</div>
</div>
</div>
<section id="examples-1" class="level2">
<h2 class="anchored" data-anchor-id="examples-1">Examples</h2>
<section id="gaussianbernoulli" class="level3">
<h3 class="anchored" data-anchor-id="gaussianbernoulli">Gaussian/Bernoulli</h3>
<div class="columns">
<div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Gaussian</strong> <span class="math inline">\(\mathcal N(\mu,\sigma)\)</span>: <span class="math display">\[p(x) = \frac{1}{\sqrt{2\pi \sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdfgauss.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Approximation of sum of iid RV (TCL)</li>
</ul>
</div><div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Binomial</strong> <span class="math inline">\(\mathrm{Bin}(n,q)\)</span>: <span class="math display">\[p(x)= \binom{n}{x}q^x (1-q)^{n-x}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdf_binom.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Number of success among <span class="math inline">\(n\)</span> Bernoulli <span class="math inline">\(q\)</span></li>
</ul>
</div>
</div>
</section>
<section id="exponentialgeometric" class="level3">
<h3 class="anchored" data-anchor-id="exponentialgeometric">Exponential/Geometric</h3>
<div class="columns">
<div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Exponential</strong> <span class="math inline">\(\mathcal E(\lambda)\)</span>: <span class="math display">\[p(x) = \lambda e^{-\lambda x}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdf_exp.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Waiting time for an atomic clock of rate <span class="math inline">\(\lambda\)</span></li>
</ul>
</div><div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Geometric</strong> <span class="math inline">\(\mathcal{G}(q)\)</span>: <span class="math display">\[p(x)= q(1-q)^{x-1}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdf_geom.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Index of first success for iid Bernoulli <span class="math inline">\(q\)</span></li>
</ul>
</div>
</div>
</section>
<section id="gammapoisson" class="level3">
<h3 class="anchored" data-anchor-id="gammapoisson">Gamma/Poisson</h3>
<div class="columns">
<div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Gamma</strong> <span class="math inline">\(\Gamma(k, \lambda)\)</span>: <span class="math display">\[p(x) = \frac{\lambda^k x^{k-1}e^{-\lambda x}}{(k-1)!}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdf_gamma.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Waiting time for <span class="math inline">\(k\)</span> atomic clocks of rate <span class="math inline">\(\lambda\)</span></li>
</ul>
</div><div class="column" style="width:50%;">
<ul class="incremental">
<li><strong>Poisson</strong> <span class="math inline">\(\mathcal{P}(\lambda)\)</span>: <span class="math display">\[p(x)=\frac{\lambda^x}{x!}e^{-\lambda}\]</span></li>
</ul>
<div class="fragment">
<p><img src="../images/basics/pdf_poisson.svg" class="img-fluid"></p>
</div>
<ul class="incremental">
<li>Number of tics before time <span class="math inline">\(1\)</span> of an atomic clock of rate <span class="math inline">\(\lambda\)</span></li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="simple-vs-simple-1" class="level1">
<h1>Simple VS Simple</h1>
<ul class="incremental">
<li>We observe <span class="math inline">\(X \in \mathcal X=\mathbb R^n\)</span>.</li>
<li><span class="math inline">\(H_0: X \sim P\)</span> or <span class="math inline">\(H_1: X \sim Q\)</span>.</li>
<li>We <strong>know</strong> <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> but we do not know whether <span class="math inline">\(X \sim P\)</span> or <span class="math inline">\(X \sim Q\)</span></li>
</ul>
<div class="fragment">
<p>For a given test <span class="math inline">\(T\)</span> we define:</p>
<ul class="incremental">
<li><strong>level</strong> of <span class="math inline">\(T\)</span> = (type-1 error): <span class="math inline">\(\alpha = P(T(X)=1)\)</span></li>
<li><strong>power</strong> of <span class="math inline">\(T\)</span> = 1 - (type-2 error): <span class="math inline">\(\beta = Q(T(X)=1) = 1-Q(T(X)=0)\)</span></li>
</ul>
</div>
<div class="fragment">
<table style="border-collapse: collapse; width: 100%; text-align: center; border: 2px solid black;">
<thead>
<tr>
<th style="text-align:center">
Decision
</th>
<th style="text-align:center">
<span class="math inline">\(H_0: X \sim P\)</span>
</th>
<th style="text-align:center">
<span class="math inline">\(H_1: X \sim Q\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">
<span class="math inline">\(T=0\)</span>
</td>
<td class="fragment green-cell" style="text-align: center">
<span class="math inline">\(1-\alpha\)</span>
</td>
<td class="fragment red-cell" style="text-align: center">
<span class="math inline">\(1-\beta\)</span>
</td>
</tr>
<tr>
<td style="text-align:center">
<span class="math inline">\(T=1\)</span>
</td>
<td class="fragment red-cell" style="text-align: center">
<span class="math inline">\(\alpha\)</span>
</td>
<td class="fragment green-cell" style="text-align: center">
<span class="math inline">\(\beta\)</span>
</td>
</tr>
</tbody>
</table>
<ul class="incremental">
<li><strong>unbiased</strong>: <span class="math inline">\(\beta \geq \alpha\)</span></li>
<li><span class="math inline">\(\alpha = 0\)</span> for trivial test <span class="math inline">\(T(x)=0\)</span> ! But <span class="math inline">\(\beta =0\)</span> too…</li>
</ul>
</div>
<section id="likelihood-ratio-test" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-ratio-test">Likelihood Ratio Test</h2>
<ul class="incremental">
<li>Test <span class="math inline">\(T\)</span> that maximizes <span class="math inline">\(\beta\)</span> at fixed <span class="math inline">\(\alpha\)</span>?</li>
<li><strong>Idea</strong>: Consider the <strong>likelihood ratio test statistic</strong> <span class="math display">\[\psi(x)=\frac{dQ}{dP}(x) = \frac{q(x)}{p(x)}\]</span></li>
<li>We consider the <strong>likelihood ratio test</strong> <span class="math display">\[ T^*(x)=\mathbf 1\left\{\frac{q(x)}{p(x)} &gt; t_{\alpha}\right\} \;\]</span></li>
<li>Equivalently, we can consider the <strong>log-likelihood ratio test</strong>: <span class="math display">\[T^*(x)=\mathbf 1\left\{\log\left(\frac{q(x)}{p(x)}\right) &gt; \log(t_{\alpha})\right\}\]</span></li>
<li><span class="math inline">\(t_{\alpha}\)</span> is the <span class="math inline">\(\alpha\)</span>-quantile of the distrib <span class="math inline">\(\frac{q(X)}{p(X)}\)</span> if <span class="math inline">\(X\sim P\)</span> <span class="math display">\[ \mathbb P_{X \sim P}\left(\frac{q(X)}{p(X)} &gt; t_{\alpha}\right) = \alpha\]</span></li>
</ul>
</section>
<section id="neyman-pearson" class="level2">
<h2 class="anchored" data-anchor-id="neyman-pearson">Neyman Pearson</h2>
<div class="callout callout-style-default callout-note callout-titled" title="Neyman Pearson's theorem">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Neyman Pearson’s theorem
</div>
</div>
<div class="callout-body-container callout-body">
<p>The likelihood Ratio Test of level <span class="math inline">\(\alpha\)</span> maximizes the power among all tests of level <span class="math inline">\(\alpha\)</span>.</p>
</div>
</div>
<ul class="incremental">
<li><p><strong>Example</strong>: <span class="math inline">\(X \sim \mathcal N(\theta, 1)\)</span>.</p></li>
<li><p><span class="math inline">\(H_0: \theta=\theta_0\)</span>, <span class="math inline">\(H_1: \theta=\theta_1\)</span>.</p></li>
<li><p>Check that the log-likelihood ratio is <span class="math display">\[ (\theta_1 - \theta_0)x + \frac{\theta_0^2 -\theta_1^2}{2} \; .\]</span></p></li>
<li><p>If <span class="math inline">\(\theta_1 &gt; \theta_0\)</span>, an optimal test if of the form <span class="math display">\[ T(x) = \mathbf 1\{ x &gt; t \} \; .\]</span></p></li>
</ul>
<section id="proof-of-neyman-pearsons-theorem" class="level3">
<h3 class="anchored" data-anchor-id="proof-of-neyman-pearsons-theorem">Proof of Neyman Pearson’s theorem</h3>
<p>We prove the theorem in the case where <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> each have a density <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> on <span class="math inline">\(\mathbb R^n\)</span>. For any <span class="math inline">\(t &gt; 0\)</span>, define <span class="math display">\[I_t(P, Q) = \int_{x \in \mathbb R^n} |q(x) - tp(x)|dx \; .\]</span></p>
<p>When <span class="math inline">\(t=1\)</span>, this quantity is equal to the total-variation distance between <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span>. For any event A in <span class="math inline">\(\mathbb R^n\)</span> , it holds that</p>
<p><span class="math display">\[
\begin{split}
  I_t(P, Q) &amp;= \int_{x \in \mathbb R^n} |q(x) - tp(x)|dx \\
  &amp;= \int_{q(x)&gt; tp(x)} q(x) - tp(x)dx + \int_{q(x)&lt; tp(x)} tp(x) - q(x)dx\\
  &amp;=  2\int_{x \in \mathbb R^n} \mathbf1_{q(x)&gt; tp(x)}(q(x) - tp(x))dx + t-1 \\
  &amp;\geq 2\int_{x \in \mathbb R^n} \mathbf 1_A \mathbf1_{q(x)&gt; tp(x)}(q(x) - tp(x))dx + t-1\\
  &amp;\geq t-1 + 2(Q(A) - tP(A)) \; .
\end{split}
\]</span></p>
<p>If <span class="math inline">\(A  = \{x \in \mathbb R^n : q(x) &gt; tp(x)\}\)</span>, then the two last inequalities are equalities. In particular, <span class="math display">\[I_t(P, Q) = t-1 + 2\sup_{A \subset \mathbb R^n}(Q(A) - tP(A))) \; .\]</span></p>
<p>Assume that the type-1 error of <span class="math inline">\(T\)</span> is smaller than <span class="math inline">\(\alpha\)</span>: <span class="math inline">\(P(T=1) \leq \alpha\)</span>.</p>
<p>The power of <span class="math inline">\(T\)</span>, <span class="math inline">\(Q(T = 1)\)</span>, is upper-bounded as follows: <span class="math display">\[
\begin{split}
  Q(T=1) &amp;\leq Q(T=1) + t(\alpha - P(T=1))\\
  &amp;= \alpha t + Q(T=1) - tP(T=1) \\
  &amp;\leq \alpha t + \frac{t-1}{2} + \frac{1}{2}I_t \; .
\end{split}
\]</span></p>
<ul class="incremental">
<li>There is equality in the second inequality if <span class="math inline">\(T=1\)</span> is the event <span class="math inline">\(\{ \frac{q(X)}{p(X)} &gt; t \}\)</span>.</li>
<li>There is equality in the first inequality if <span class="math inline">\(P(T=1) = \alpha\)</span>.</li>
</ul>
<p>Let <span class="math inline">\(t_{\alpha}\)</span> be such that <span class="math inline">\(P(\frac{q(X)}{p(X)}&gt; t_{\alpha}) = \alpha\)</span>. The test <span class="math inline">\(T^*(X) = \mathbf1 \{\frac{q(X)}{p(X)}&gt; t_{\alpha}\}\)</span> satisfies the two above points, since its rejection event is exactly <span class="math inline">\(\{T^*(X) = 1\} = \{\frac{q(X)}{p(X)}&gt; t_{\alpha}\}\)</span> and since <span class="math inline">\(P(T^* = 1) = \alpha.\)</span> Hence, for any test <span class="math inline">\(T\)</span> of type 1 error smaller than <span class="math inline">\(\alpha\)</span>, it holds that <span class="math inline">\(Q(T = 1) \leq Q(T^* = 1)\)</span>.</p>
</section>
</section>
<section id="examples-2" class="level2">
<h2 class="anchored" data-anchor-id="examples-2">Examples</h2>
<section id="example-gaussians" class="level3">
<h3 class="anchored" data-anchor-id="example-gaussians">Example (Gaussians)</h3>
<ul class="incremental">
<li><p>Let <span class="math inline">\(P_{\theta}\)</span> be the distribution <span class="math inline">\(\mathcal N(\theta,1)\)</span>.</p></li>
<li><p>Observe <span class="math inline">\(n\)</span> iid data <span class="math inline">\(X = (X_1, \dots, X_n)\)</span></p></li>
<li><p><span class="math inline">\(H_0: X \sim P^{\otimes n}_{\theta_0}\)</span> or <span class="math inline">\(H_1: X \sim P^{\otimes n}_{\theta_1}\)</span></p></li>
<li><p>Remark: <span class="math inline">\(P^{\otimes n}_{\theta}= \mathcal N((\theta,\dots, \theta), I_n)\)</span></p></li>
<li><p>Density of <span class="math inline">\(P^{\otimes n}_{\theta}\)</span>:</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\frac{d P^{\otimes n}_{\theta}}{dx} &amp;= \frac{d P_{\theta}}{dx_1}\dots\frac{d P_{\theta}}{dx_n} \\
&amp;= \frac{1}{\sqrt{2\pi}^n}\exp\left({-\sum_{i=1}^n\frac{(x_i -&nbsp;\theta)^2}{2}}\right) \\
&amp;=  \frac{1}{\sqrt{2\pi}^n}\exp\left(-\frac{\|x\|^2}{2} + n\theta \overline x - \frac{\theta^2}{2}\right)\; .
\end{aligned}
\]</span></p>
<ul class="incremental">
<li>Log-likelihood ratio test:</li>
<li><span class="math inline">\(T(x) = \mathbf 1\{\overline x &gt; t_{\alpha}\}\)</span> if <span class="math inline">\(\theta_1 &gt; \theta_0\)</span></li>
<li><span class="math inline">\(T(x) = \mathbf 1\{\overline x &lt; t_{\alpha}\}\)</span> otherwise</li>
</ul>
</section>
<section id="example-exponential-families" class="level3">
<h3 class="anchored" data-anchor-id="example-exponential-families">Example: Exponential Families</h3>
<ul class="incremental">
<li><p>A set of distributions <span class="math inline">\(\{P_{\theta}\}\)</span> is an exponential family if each density <span class="math inline">\(p_{\theta}(x)\)</span> is of the form <span class="math display">\[ p_{\theta}(x) = a(\theta)b(x) \exp(c(\theta)d(x)) \; , \]</span></p></li>
<li><p>We observe <span class="math inline">\(X = (X_1, \dots, X_n)\)</span>. Consider the following testing problem: <span class="math display">\[H_0: X \sim P_{\theta_0}^{\otimes n}~~~~ \text{or}~~~~ H_1:X \sim P_{\theta_1}^{\otimes n} \; .\]</span></p></li>
<li><p>Likelihood ratio: <span class="math display">\[
\frac{dP^{\otimes n}_{\theta_1}}{dP^{\otimes n}_{\theta_0}} = \left(\frac{a(\theta_1)}{a(\theta_0)}\right)^n\exp\left((c(\theta_1)-c(\theta_0))\sum_{i=1}^n d(x_i)\right) \; .
\]</span></p></li>
</ul>
<p><span class="math display">\[
T(X) = \mathbf 1\left\{\frac{1}{n}\sum_{i=1}^n d(X_i) &gt; t\right\} \;. ~~~~\text{(calibrate $t$)}\]</span></p>
</section>
<section id="example-radioactive-source" class="level3">
<h3 class="anchored" data-anchor-id="example-radioactive-source">Example: Radioactive Source</h3>
<ul class="incremental">
<li><p>The number of particle emitted in <span class="math inline">\(1\)</span> unit of time is follows distribution <span class="math inline">\(P \sim \mathcal P(\lambda)\)</span>.</p></li>
<li><p>We observe <strong><span class="math inline">\(20\)</span> time units</strong>, that is <span class="math inline">\(N \sim \mathcal P(20\lambda)\)</span>.</p></li>
<li><p><strong>Type A</strong> sources emit an average of <span class="math inline">\(\lambda_0 = 0.6\)</span> particles/time unit</p></li>
<li><p><strong>Type B</strong> sources emit an average of <span class="math inline">\(\lambda_1 = 0.8\)</span> particles/time unit</p></li>
<li><p><span class="math inline">\(H_0\)</span>: <span class="math inline">\(N \sim \mathcal P(20\lambda_0)\)</span> or <span class="math inline">\(H_1\)</span>: <span class="math inline">\(N\sim \mathcal P(20\lambda_1)\)</span></p></li>
<li><p>Likelihood Ratio Test: <span class="math display">\[T(X)=\mathbf 1\left\{\sum_{i=1}^{20}X_i &gt; t_{\alpha}\right\} \; .\]</span></p></li>
<li><p><span class="math inline">\(t_{0.95}\)</span>:&nbsp;&nbsp; <code>quantile(Poisson(20*0.6), 0.95)</code> gives <span class="math inline">\(18\)</span><br>
</p></li>
<li><p><span class="math inline">\(\mathbb P(\mathcal P(20*0.6) \leq 17)\)</span>: <code>1-cdf(Poisson(20*0.6), 17)</code> gives <span class="math inline">\(0.063\)</span><br>
</p></li>
<li><p><span class="math inline">\(\mathbb P(\mathcal P(20*0.6) \leq 18)\)</span>: <code>1-cdf(Poisson(20*0.6), 18)</code> gives <span class="math inline">\(0.038\)</span>: reject if <span class="math inline">\(N \geq 19\)</span><br>
</p></li>
</ul>
</section>
</section>
</section>
<section id="multiple-multiple-tests" class="level1">
<h1>Multiple-Multiple Tests</h1>
<section id="generalities" class="level2">
<h2 class="anchored" data-anchor-id="generalities">Generalities</h2>
<ul class="incremental">
<li><p><span class="math inline">\(H_0 = \{ \mathcal P_{\theta}, \theta \in \Theta_0 \}\)</span> is not a singleton</p></li>
<li><p>No meaning of <span class="math inline">\(\mathbb P_{H_0}(X \in A)\)</span></p></li>
<li><p><strong>level</strong> of <span class="math inline">\(T\)</span>: <span class="math display">\[
\alpha = \sup_{\theta \in \Theta_0}P_{\theta}(T(X)=1) \; .
\]</span></p></li>
<li><p><strong>power function</strong> <span class="math inline">\(\beta: \Theta_1 \to [0,1]\)</span> <span class="math display">\[
\beta(\theta) = P_{\theta}(T(X)=1)
\]</span></p></li>
<li><p><span class="math inline">\(T\)</span> is <strong>unbiased</strong> if <span class="math inline">\(\beta (\theta) \geq \alpha\)</span> for all <span class="math inline">\(\theta \in \Theta_1\)</span>.</p></li>
<li><p>If <span class="math inline">\(T_1\)</span>, <span class="math inline">\(T_2\)</span> are two tests of level <span class="math inline">\(\alpha_1\)</span>, <span class="math inline">\(\alpha_2\)</span></p></li>
<li><p><span class="math inline">\(T_2\)</span> is uniformly more powerfull (<span class="math inline">\(UMP\)</span>) than <span class="math inline">\(T_1\)</span> if</p>
<ol class="incremental" type="1">
<li><span class="math inline">\(\alpha_2 \leq \alpha_1\)</span></li>
<li><span class="math inline">\(\beta_2(\theta) \geq \beta_1(\theta)\)</span> for all <span class="math inline">\(\theta \in \Theta_1\)</span></li>
</ol></li>
<li><p><span class="math inline">\(T^*\)</span> is <span class="math inline">\(UMP_{\alpha}\)</span> if it is <span class="math inline">\(UMP\)</span> than any other test <span class="math inline">\(T\)</span> of level <span class="math inline">\(\alpha\)</span>.</p></li>
</ul>
</section>
<section id="multiple-multiple-tests-in-mathbb-r" class="level2">
<h2 class="anchored" data-anchor-id="multiple-multiple-tests-in-mathbb-r">Multiple-Multiple Tests in <span class="math inline">\(\mathbb R\)</span></h2>
<p>Assumption: <span class="math inline">\(\Theta_0 \cup \Theta_1 \subset \mathbb R\)</span>.</p>
<ul class="incremental">
<li><p><strong>One-tailed tests</strong>: <span class="math display">\[
\begin{aligned}
H_0: \theta \leq \theta_0 ~~~~ &amp;\text{ or } ~~~ H_1: \theta &gt; \theta_0 ~~~ \text{(right-tailed: unilatéral droit)}\\
H_0: \theta \geq \theta_0 ~~~ &amp;\text{ or } ~~~ H_1: \theta &lt; \theta_0 ~~~ \text{(left-tailed: unilatéral gauche)}
\end{aligned}
\]</span></p></li>
<li><p><strong>Two-tailed tests</strong>: <span class="math display">\[
\begin{aligned}
H_0: \theta = \theta_0 ~~~ &amp;\text{ or } ~~~ H_1: \theta \neq \theta_0 ~~~ \text{(simple/multiple)}\\
H_0: \theta \in [\theta_1, \theta_2] ~~~ &amp;\text{ or } ~~~ H_1: \theta \not \in [\theta_1, \theta_2] ~~~ \text{( multiple/multiple)}
\end{aligned}
\]</span></p></li>
</ul>
<div class="fragment">
<div class="callout callout-style-default callout-note callout-titled" title="Theorem">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theorem
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="incremental">
<li>Assume that <span class="math inline">\(p_{\theta}(x) = a(\theta)b(x)\exp(c(\theta)d(x))\)</span> and that <span class="math inline">\(c\)</span> is a non-decreasing (croissante) function, and consider a one-tailed test problem.</li>
<li>There exists a UMP<span class="math inline">\(\alpha\)</span> test. It is <span class="math inline">\(\mathbf 1\{\sum d(X_i) &gt; t \}\)</span> if <span class="math inline">\(H_1: \theta &gt; \theta_0\)</span> (right-tailed test).</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="pivotal-test-statistic-and-p-value" class="level1">
<h1>Pivotal Test Statistic and P-value</h1>
<section id="pivotal-test-statistic" class="level2">
<h2 class="anchored" data-anchor-id="pivotal-test-statistic">Pivotal Test Statistic</h2>
<ul class="incremental">
<li>Consider <span class="math inline">\(\Theta_0\)</span> not singleton. <span class="math inline">\(\mathbb P_{H_0}(X \in A)\)</span> has no meaning.</li>
</ul>
<div class="fragment">
<div class="callout callout-style-default callout-note callout-titled" title="Pivotal test statistic">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pivotal test statistic
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(\psi: \mathcal X \to \mathbb R\)</span> is <strong>pivotal</strong> if the distribution of <span class="math inline">\(\psi(X)\)</span> under <span class="math inline">\(H_0\)</span> does not depend on <span class="math inline">\(\theta \in \Theta_0\)</span>:<br>
</p>
<p>for any <span class="math inline">\(\theta, \theta' \in \Theta_0\)</span>, and any event <span class="math inline">\(A\)</span>, <span class="math display">\[ \mathbb P_{\theta}(\psi(X) \in A) = \mathbb P_{\theta'}(\psi(X) \in A) \; .\]</span></p>
</div>
</div>
</div>
<ul class="incremental">
<li>Example: If <span class="math inline">\(X=(X_1, \dots, X_n)\)</span> are iid <span class="math inline">\(\mathcal N(0, \sigma)\)</span>, the distrib of <span class="math display">\[ \psi(X) = \frac{\sum_{i=1}^n \overline X}{\sqrt{\sum_{i=1}^n X_i^2}}\]</span> does not depend on <span class="math inline">\(\sigma\)</span>.</li>
</ul>
</section>
<section id="p-value" class="level2">
<h2 class="anchored" data-anchor-id="p-value">P-value</h2>
<p>See the (<a href="../pluto/illustration_pvalue.html">Pluto notebook: Illustration of pvalue</a>)</p>
<div class="callout callout-style-default callout-note callout-titled" title="P-value: definition">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
P-value: definition
</div>
</div>
<div class="callout-body-container callout-body">
<p>We define <span class="math inline">\(p_{value}(x_{\mathrm{obs}}) =\mathbb P(\psi(X) &gt; x_{\mathrm{obs}})\)</span> for a right-tailed test.</p>
<p>For a two-tailed test, <span class="math inline">\(p_{value}(x_{\mathrm{obs}}) =2\min(\mathbb P(\psi(X) &gt; x_{\mathrm{obs}}),\mathbb P(\psi(X) &lt; x_{\mathrm{obs}}))\)</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="P-value under $H_0$">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
P-value under <span class="math inline">\(H_0\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Under <span class="math inline">\(H_0\)</span>, for a pivotal test statistic <span class="math inline">\(\psi\)</span>, <span class="math inline">\(p_{value}(X)\)</span> has a uniform distribution <span class="math inline">\(\mathcal U([0,1])\)</span>.</p>
</div>
</div>
<p><strong>Proof</strong>.</p>
<p>The p-value is a probability, so it belongs to <span class="math inline">\([0,1]\)</span>. Let <span class="math inline">\(F_{\psi}\)</span> be the cumulative distribution function of a random variable <span class="math inline">\(\psi(X)\)</span> when <span class="math inline">\(X\)</span> follows distribution <span class="math inline">\(P\)</span>, that is <span class="math inline">\(G_{\psi}(t) = \mathbb P(\psi(X) &gt; t)\)</span>. It holds that <span class="math display">\[
\mathbb P(\psi(X') &gt; \psi(X) ~|~ \psi(X)) = F_{\psi}(\psi(X))
\]</span> If <span class="math inline">\(u \in [0,1]\)</span>, then <span class="math display">\[
\begin{aligned}
\mathbb P(\mathrm{pvalue}(X) &gt; u) &amp;= \mathbb P(F_{\psi}(\psi(X)) &gt; u) \\
&amp;= \mathbb P(\psi(X) &gt; F_{\psi}^{-1}(u)) \\
&amp;= 1- F_{\psi}(F_{\psi}^{-1}(u)) = 1-u
\end{aligned}
\]</span> Hence, <span class="math inline">\(\mathrm{pvalue}(X)\)</span> is uniform when <span class="math inline">\(X\)</span> follows distribution <span class="math inline">\(\mathbb P\)</span>. <span class="math display">\[\tag*{$\blacksquare$}\]</span></p>
<div class="columns">
<div class="column" style="width:50%;">
<ul class="incremental">
<li>In practice: reject if <span class="math inline">\(p_{value}(X) &lt; \alpha = 0.05\)</span></li>
<li><span class="math inline">\(\alpha\)</span> is the <strong>level</strong> or <strong>type-1-error</strong> of the test</li>
</ul>
</div><div class="column" style="width:50%;">
<ul class="incremental">
<li>Illustration if <span class="math inline">\(\psi(X) \sim \mathcal N(0,1)\)</span> under <span class="math inline">\(H_0\)</span>: <img src="../images/basics/pvalue_uniform.svg" class="img-fluid"></li>
</ul>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>